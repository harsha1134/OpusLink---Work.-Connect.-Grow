<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>OpusLink — Admin Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
  /* Black & Gold Theme Variables */
  :root {
    --bg-primary: #0a0a0a;
    --bg-secondary: #111111;
    --bg-card: #1a1a1a;
    --bg-hover: #222222;
    --text-primary: #ffffff;
    --text-secondary: #a0a0a0;
    --text-muted: #666666;
    --gold-primary: #ffd700;
    --gold-secondary: #b8860b;
    --gold-accent: #daa520;
    --border-color: #333333;
    --success: #10b981;
    --warning: #f59e0b;
    --error: #ef4444;
    --info: #3b82f6;
  }

  /* Base Styles */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    background: var(--bg-primary);
    color: var(--text-primary);
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    line-height: 1.6;
    overflow-x: hidden;
  }

  .app {
    display: flex;
    min-height: 100vh;
    background: var(--bg-primary);
  }

  /* Sidebar Styling */
  .sidebar {
    width: 260px;
    background: var(--bg-secondary);
    border-right: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
    transition: all 0.3s ease;
    position: fixed;
    height: 100vh;
    z-index: 100;
  }

  .brand {
    display: flex;
    align-items: center;
    padding: 20px;
    border-bottom: 1px solid var(--border-color);
    gap: 12px;
  }

  .logo {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    background: linear-gradient(135deg, var(--gold-primary), var(--gold-secondary));
    color: #000;
    font-weight: 800;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
  }

  .brand-text {
    flex: 1;
  }

  .title {
    color: var(--text-primary);
    font-weight: 700;
    font-size: 1.2rem;
  }

  .subtitle {
    color: var(--gold-primary);
    font-weight: 500;
    font-size: 0.8rem;
  }

  .nav {
    flex: 1;
    padding: 20px 0;
    overflow-y: auto;
  }

  .nav-link {
    display: flex;
    align-items: center;
    padding: 12px 20px;
    color: var(--text-secondary);
    text-decoration: none;
    border-radius: 8px;
    margin: 4px 12px;
    transition: all 0.3s ease;
    position: relative;
  }

  .nav-link:hover {
    background: var(--bg-hover);
    color: var(--gold-primary);
    transform: translateX(4px);
  }

  .nav-link.active {
    background: linear-gradient(135deg, var(--bg-card), var(--bg-hover));
    color: var(--gold-primary);
    border-left: 3px solid var(--gold-primary);
    font-weight: 600;
  }

  .nav-link span {
    margin-right: 12px;
    font-size: 1.1rem;
  }

  .nav-badge {
    background: var(--error);
    color: white;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    font-size: 0.7rem;
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
  }

  .side-footer {
    padding: 20px;
    border-top: 1px solid var(--border-color);
    color: var(--text-muted);
    font-size: 0.8rem;
  }

  /* Main Content */
  main {
    flex: 1;
    margin-left: 260px;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  /* Topbar Styling */
  .topbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 24px;
    background: var(--bg-secondary);
    border-bottom: 1px solid var(--border-color);
    position: sticky;
    top: 0;
    z-index: 99;
  }

  .searchbar {
    flex: 1;
    max-width: 500px;
    position: relative;
  }

  .searchbar input {
    width: 100%;
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    color: var(--text-primary);
    border-radius: 8px;
    padding: 10px 16px;
    padding-left: 40px;
    font-size: 0.9rem;
    transition: all 0.3s ease;
  }

  .searchbar input:focus {
    outline: none;
    border-color: var(--gold-primary);
    box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.1);
  }

  .searchbar i {
    position: absolute;
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-muted);
  }

  .user-info {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-left: 20px;
  }

  .user-details {
    text-align: right;
  }

  .user-name {
    font-weight: 700;
    font-size: 0.9rem;
  }

  .user-role {
    color: var(--text-muted);
    font-size: 0.8rem;
  }

  .avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--gold-primary), var(--gold-secondary));
    color: #000;
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
  }

  /* Content Area */
  .content {
    flex: 1;
    padding: 24px;
    overflow-y: auto;
  }

  .dashboard-section {
    display: none;
  }

  .dashboard-section.active {
    display: block;
    animation: fadeIn 0.5s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Card Styling */
  .card {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    margin-bottom: 24px;
    overflow: hidden;
  }

  .section-title {
    padding: 20px 24px;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .section-title h2 {
    color: var(--text-primary);
    font-size: 1.5rem;
    font-weight: 700;
  }

  .section-subtitle {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-top: 4px;
  }

  .section-actions {
    display: flex;
    gap: 12px;
  }

  /* Admin Specific Styles */
  .admin-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }

  .admin-stat-card {
    background: linear-gradient(135deg, var(--bg-card), var(--bg-secondary));
    padding: 24px;
    border-radius: 12px;
    border: 1px solid var(--border-color);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .admin-stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--gold-primary), var(--gold-secondary));
  }

  .admin-stat-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 30px rgba(255, 215, 0, 0.1);
    border-color: var(--gold-primary);
  }

  .admin-stat-card.critical::before {
    background: linear-gradient(90deg, #ef4444, #dc2626);
  }

  .admin-stat-card.warning::before {
    background: linear-gradient(90deg, #f59e0b, #d97706);
  }

  .admin-stat-card.success::before {
    background: linear-gradient(90deg, #10b981, #059669);
  }

  .stat-value {
    font-size: 2.5rem;
    font-weight: 800;
    color: var(--gold-primary);
    margin: 12px 0;
    text-shadow: 0 2px 4px rgba(255, 215, 0, 0.2);
  }

  .stat-label {
    color: var(--text-secondary);
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-weight: 600;
  }

  .stat-change {
    font-size: 0.75rem;
    font-weight: 600;
    margin-top: 8px;
  }

  .change-positive {
    color: var(--success);
  }

  .change-negative {
    color: var(--error);
  }

  .charts-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 24px;
    margin-bottom: 30px;
  }

  .chart-container {
    background: var(--bg-card);
    padding: 24px;
    border-radius: 12px;
    border: 1px solid var(--border-color);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  }

  .chart-container h3 {
    color: var(--text-primary);
    margin-bottom: 16px;
    font-weight: 600;
  }

  .chart-placeholder {
    height: 300px;
    background: var(--bg-secondary);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-muted);
    font-size: 0.875rem;
    border: 1px dashed var(--border-color);
  }

  .quick-actions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    margin-bottom: 30px;
  }

  .quick-action-card {
    background: linear-gradient(135deg, var(--bg-card), var(--bg-secondary));
    padding: 24px;
    border-radius: 12px;
    text-align: center;
    border: 1px solid var(--border-color);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .quick-action-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, var(--gold-primary), var(--gold-secondary));
    transform: scaleX(0);
    transition: transform 0.3s ease;
  }

  .quick-action-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 30px rgba(255, 215, 0, 0.15);
    border-color: var(--gold-primary);
  }

  .quick-action-card:hover::before {
    transform: scaleX(1);
  }

  .action-icon {
    font-size: 2.5rem;
    margin-bottom: 16px;
    display: block;
    background: linear-gradient(135deg, var(--gold-primary), var(--gold-secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .action-title {
    color: var(--text-primary);
    font-weight: 600;
    margin-bottom: 8px;
  }

  .action-desc {
    color: var(--text-secondary);
    font-size: 0.875rem;
  }

  .recent-activity {
    background: var(--bg-card);
    border-radius: 12px;
    padding: 24px;
    border: 1px solid var(--border-color);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  }

  .activity-item {
    display: flex;
    align-items: flex-start;
    padding: 16px 0;
    border-bottom: 1px solid var(--border-color);
    transition: all 0.3s ease;
  }

  .activity-item:hover {
    background: var(--bg-hover);
    margin: 0 -16px;
    padding: 16px;
    border-radius: 8px;
  }

  .activity-item:last-child {
    border-bottom: none;
  }

  .activity-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 16px;
    flex-shrink: 0;
    font-size: 1.2rem;
  }

  .activity-icon.user {
    background: linear-gradient(135deg, #1e40af, #3730a3);
    color: white;
  }

  .activity-icon.job {
    background: linear-gradient(135deg, #059669, #047857);
    color: white;
  }

  .activity-icon.payment {
    background: linear-gradient(135deg, #d97706, #b45309);
    color: white;
  }

  .activity-icon.alert {
    background: linear-gradient(135deg, #dc2626, #b91c1c);
    color: white;
  }

  .activity-content {
    flex: 1;
  }

  .activity-title {
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 4px;
  }

  .activity-desc {
    color: var(--text-secondary);
    font-size: 0.875rem;
    margin-bottom: 4px;
  }

  .activity-time {
    color: var(--text-muted);
    font-size: 0.75rem;
  }

  .admin-section-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .admin-section-title span {
    flex: 1;
  }

  .view-all-link {
    color: var(--gold-primary);
    font-size: 0.875rem;
    font-weight: 500;
    text-decoration: none;
    transition: all 0.3s ease;
  }

  .view-all-link:hover {
    color: var(--gold-secondary);
    text-decoration: underline;
  }

  .system-health {
    background: var(--bg-card);
    border-radius: 12px;
    padding: 24px;
    border: 1px solid var(--border-color);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  }

  .health-indicator {
    display: flex;
    align-items: center;
    padding: 12px;
    border-radius: 8px;
    transition: all 0.3s ease;
  }

  .health-indicator:hover {
    background: var(--bg-hover);
  }

  .health-status {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    margin-right: 16px;
    box-shadow: 0 0 10px currentColor;
  }

  .health-status.healthy {
    background: var(--success);
    color: var(--success);
  }

  .health-status.warning {
    background: var(--warning);
    color: var(--warning);
  }

  .health-status.critical {
    background: var(--error);
    color: var(--error);
  }

  .health-title {
    color: var(--text-primary);
    font-weight: 600;
    margin-bottom: 2px;
  }

  .health-desc {
    color: var(--text-secondary);
    font-size: 0.875rem;
  }

  /* Form Styling */
  .form-card {
    background: var(--bg-secondary);
    padding: 24px;
    border-radius: 12px;
    border: 1px solid var(--border-color);
    margin-bottom: 24px;
  }

  .form-card h4 {
    color: var(--text-primary);
    margin-bottom: 20px;
    font-weight: 600;
  }

  .form-group {
    margin-bottom: 16px;
  }

  .form-group label {
    color: var(--text-primary);
    font-weight: 500;
    margin-bottom: 8px;
    display: block;
  }

  .form-control {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    color: var(--text-primary);
    border-radius: 8px;
    padding: 12px 16px;
    width: 100%;
    transition: all 0.3s ease;
    font-size: 0.9rem;
  }

  .form-control:focus {
    outline: none;
    border-color: var(--gold-primary);
    box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.1);
  }

  .form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-bottom: 16px;
  }

  .permissions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 12px;
    margin-top: 12px;
  }

  .checkbox-label {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    background: var(--bg-card);
    border-radius: 8px;
    border: 1px solid var(--border-color);
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .checkbox-label:hover {
    border-color: var(--gold-primary);
    background: var(--bg-hover);
    transform: translateY(-2px);
  }

  .checkbox-label input[type="checkbox"] {
    margin: 0;
    accent-color: var(--gold-primary);
  }

  /* Button Styling */
  .btn {
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: 600;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.875rem;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }

  .btn-primary {
    background: linear-gradient(135deg, var(--gold-primary), var(--gold-secondary));
    color: #000;
  }

  .btn-primary:hover {
    background: linear-gradient(135deg, var(--gold-secondary), var(--gold-primary));
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
  }

  .btn-ghost {
    background: transparent;
    color: var(--text-secondary);
    border: 1px solid var(--border-color);
  }

  .btn-ghost:hover {
    background: var(--bg-hover);
    color: var(--text-primary);
    border-color: var(--gold-primary);
  }

  .btn-warning {
    background: linear-gradient(135deg, #f59e0b, #d97706);
    color: white;
  }

  .btn-warning:hover {
    background: linear-gradient(135deg, #d97706, #b45309);
    transform: translateY(-2px);
  }

  .btn-success {
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
  }

  .btn-success:hover {
    background: linear-gradient(135deg, #059669, #047857);
    transform: translateY(-2px);
  }

  .btn-danger {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    color: white;
  }

  .btn-danger:hover {
    background: linear-gradient(135deg, #dc2626, #b91c1c);
    transform: translateY(-2px);
  }

  .btn-sm {
    padding: 6px 12px;
    font-size: 0.75rem;
  }

  .form-actions {
    display: flex;
    gap: 12px;
    margin-top: 24px;
  }

  /* Table Styling */
  .table-responsive {
    overflow-x: auto;
    border-radius: 12px;
    border: 1px solid var(--border-color);
  }

  .data-table {
    width: 100%;
    border-collapse: collapse;
    background: var(--bg-card);
    color: var(--text-primary);
    min-width: 800px;
  }

  .data-table th {
    background: var(--bg-secondary);
    padding: 16px;
    text-align: left;
    font-weight: 600;
    color: var(--text-primary);
    border-bottom: 2px solid var(--gold-primary);
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .data-table td {
    padding: 16px;
    border-bottom: 1px solid var(--border-color);
    color: var(--text-secondary);
  }

  .data-table tbody tr {
    transition: all 0.3s ease;
  }

  .data-table tbody tr:hover {
    background: var(--bg-hover);
  }

  .data-table tbody tr:last-child td {
    border-bottom: none;
  }

  /* Status Badges */
  .status-badge {
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .status-active, .status-completed, .status-resolved, .status-verified {
    background: rgba(16, 185, 129, 0.1);
    color: #10b981;
    border: 1px solid rgba(16, 185, 129, 0.3);
  }

  .status-pending, .status-pending-verification {
    background: rgba(245, 158, 11, 0.1);
    color: #f59e0b;
    border: 1px solid rgba(245, 158, 11, 0.3);
  }

  .status-suspended, .status-rejected, .status-cancelled {
    background: rgba(239, 68, 68, 0.1);
    color: #ef4444;
    border: 1px solid rgba(239, 68, 68, 0.3);
  }

  /* Role Badges */
  .role-badge {
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
  }

  .role-admin {
    background: rgba(255, 215, 0, 0.1);
    color: var(--gold-primary);
    border: 1px solid rgba(255, 215, 0, 0.3);
  }

  .role-employer {
    background: rgba(59, 130, 246, 0.1);
    color: #3b82f6;
    border: 1px solid rgba(59, 130, 246, 0.3);
  }

  .role-worker {
    background: rgba(16, 185, 129, 0.1);
    color: #10b981;
    border: 1px solid rgba(16, 185, 129, 0.3);
  }

  /* Grid Layout */
  .grid-2 {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 24px;
  }

  .grid-3 {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 24px;
  }

  /* Empty State */
  .empty-state {
    text-align: center;
    padding: 60px 24px;
    color: var(--text-muted);
  }

  .empty-state-icon {
    font-size: 4rem;
    margin-bottom: 20px;
    opacity: 0.5;
  }

  .empty-state h3 {
    color: var(--text-primary);
    margin-bottom: 12px;
    font-size: 1.25rem;
  }

  .empty-state p {
    color: var(--text-secondary);
    margin: 0;
  }

  /* Notification Bell */
  .notification-wrapper {
    position: relative;
    margin-right: 16px;
  }

  .notification-btn {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 8px 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    color: var(--text-secondary);
  }

  .notification-btn:hover {
    border-color: var(--gold-primary);
    background: var(--bg-hover);
    color: var(--text-primary);
  }

  .notification-badge {
    background: var(--error);
    color: white;
    border-radius: 50%;
    width: 18px;
    height: 18px;
    font-size: 0.7rem;
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    top: -4px;
    right: -4px;
  }

  /* User Avatar */
  .user-avatar-small {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--gold-primary);
    color: #000;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 0.8rem;
    margin-right: 12px;
  }

  .user-info-small {
    display: flex;
    align-items: center;
  }

  .user-name {
    font-weight: 600;
    color: var(--text-primary);
  }

  .user-email {
    font-size: 0.8rem;
    color: var(--text-muted);
  }

  /* Verification Queue */
  .verification-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    margin-bottom: 24px;
  }

  .stat-card {
    background: var(--bg-card);
    padding: 20px;
    border-radius: 12px;
    border: 1px solid var(--border-color);
    text-align: center;
  }

  .verification-list {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .verification-item {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.3s ease;
  }

  .verification-item:hover {
    border-color: var(--gold-primary);
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  }

  .verification-item-content {
    display: flex;
    align-items: center;
    gap: 16px;
    flex: 1;
  }

  .user-avatar-large {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--gold-primary), var(--gold-secondary));
    color: #000;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.5rem;
  }

  .verification-details h4 {
    color: var(--text-primary);
    margin-bottom: 8px;
  }

  .user-meta {
    display: flex;
    gap: 12px;
    margin-bottom: 8px;
    flex-wrap: wrap;
  }

  .user-meta span {
    font-size: 0.8rem;
    color: var(--text-secondary);
  }

  .verification-stats {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .stat-tag {
    background: var(--bg-secondary);
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 0.75rem;
    color: var(--text-secondary);
  }

  .verification-actions {
    display: flex;
    gap: 8px;
  }

  /* Modal */
  .modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: 20px;
  }

  .modal-content {
    background: var(--bg-card);
    border-radius: 12px;
    max-width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
    width: 600px;
  }

  .modal-header {
    padding: 20px;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .modal-header h3 {
    margin: 0;
    color: var(--text-primary);
  }

  .modal-close {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--text-muted);
  }

  .modal-body {
    padding: 20px;
  }

  .user-details-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-bottom: 20px;
  }

  .detail-item {
    display: flex;
    flex-direction: column;
  }

  .detail-item label {
    font-weight: 600;
    color: var(--text-secondary);
    font-size: 0.8rem;
    margin-bottom: 4px;
  }

  .detail-section {
    margin-bottom: 16px;
  }

  .detail-section label {
    font-weight: 600;
    color: var(--text-secondary);
    font-size: 0.8rem;
    margin-bottom: 8px;
    display: block;
  }

  .bio-content, .skills-list {
    background: var(--bg-secondary);
    padding: 12px;
    border-radius: 8px;
    border: 1px solid var(--border-color);
  }

  .modal-actions {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
    margin-top: 20px;
  }

  /* Responsive Design */
  @media (max-width: 1200px) {
    .sidebar {
      width: 80px;
    }
    
    .sidebar .brand-text,
    .sidebar .nav-link span:last-child,
    .sidebar .side-footer .kv {
      display: none;
    }
    
    .sidebar .brand {
      justify-content: center;
      padding: 20px 10px;
    }
    
    .sidebar .nav-link {
      justify-content: center;
      padding: 12px;
    }
    
    .sidebar .nav-link span:first-child {
      margin-right: 0;
    }
    
    main {
      margin-left: 80px;
    }
  }

  @media (max-width: 1024px) {
    .grid-2, .grid-3 {
      grid-template-columns: 1fr;
    }
    
    .charts-grid {
      grid-template-columns: 1fr;
    }
    
    .form-grid {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 768px) {
    .admin-stats-grid {
      grid-template-columns: 1fr;
    }
    
    .quick-actions-grid {
      grid-template-columns: 1fr;
    }
    
    .topbar {
      flex-direction: column;
      gap: 16px;
      align-items: stretch;
    }
    
    .searchbar {
      max-width: 100%;
    }
    
    .user-info {
      justify-content: space-between;
    }
    
    .verification-item {
      flex-direction: column;
      align-items: flex-start;
      gap: 16px;
    }
    
    .verification-actions {
      width: 100%;
      justify-content: space-between;
    }
    
    .content {
      padding: 16px;
    }
  }

  @media (max-width: 480px) {
    .section-title {
      flex-direction: column;
      align-items: flex-start;
      gap: 16px;
    }
    
    .section-actions {
      width: 100%;
      justify-content: space-between;
    }
    
    .form-actions {
      flex-direction: column;
    }
    
    .admin-actions {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .verification-actions {
      flex-direction: column;
    }
  }
  /* Enhanced Sidebar Styling */
.sidebar {
    width: 280px; /* Increased width for better spacing */
    background: linear-gradient(180deg, var(--bg-secondary) 0%, #0d0d0d 100%);
    border-right: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
    transition: all 0.3s ease;
    position: fixed;
    height: 100vh;
    z-index: 100;
    box-shadow: 4px 0 20px rgba(0, 0, 0, 0.3);
}

.brand {
    display: flex;
    align-items: center;
    padding: 24px 20px;
    border-bottom: 1px solid rgba(255, 215, 0, 0.2);
    gap: 16px;
    background: rgba(10, 10, 10, 0.8);
    backdrop-filter: blur(10px);
}

.logo {
    width: 48px; /* Increased size */
    height: 48px;
    border-radius: 12px; /* More rounded */
    background: linear-gradient(135deg, var(--gold-primary), var(--gold-secondary));
    color: #000;
    font-weight: 900; /* Bolder */
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.4rem;
    box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
    transition: all 0.3s ease;
}

.logo:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
}

.brand-text {
    flex: 1;
}

.title {
    color: var(--gold-primary); /* Changed to gold */
    font-weight: 800;
    font-size: 1.4rem;
    letter-spacing: -0.5px;
}

.subtitle {
    color: var(--gold-secondary);
    font-weight: 600;
    font-size: 0.85rem;
    opacity: 0.9;
}

.nav {
    flex: 1;
    padding: 24px 0;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 8px; /* Added gap between nav items */
}

.nav-link {
    display: flex;
    align-items: center;
    padding: 14px 20px; /* Increased padding */
    color: var(--text-secondary);
    text-decoration: none;
    border-radius: 12px; /* More rounded */
    margin: 0 16px; /* Increased margin */
    transition: all 0.3s ease;
    position: relative;
    border: 1px solid transparent;
    font-weight: 500;
}

.nav-link:hover {
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(184, 134, 11, 0.05));
    color: var(--gold-primary);
    transform: translateX(8px); /* Increased translation */
    border-color: rgba(255, 215, 0, 0.2);
    box-shadow: 0 4px 15px rgba(255, 215, 0, 0.1);
}

.nav-link.active {
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(184, 134, 11, 0.1));
    color: var(--gold-primary) !important; /* Force gold color */
    border-left: 4px solid var(--gold-primary);
    font-weight: 700;
    border-color: rgba(255, 215, 0, 0.3);
    box-shadow: 0 4px 20px rgba(255, 215, 0, 0.15);
}

/* Gold color for section names */
.nav-link span:last-child {
    color: inherit; /* Inherit from parent */
    font-weight: inherit;
    transition: all 0.3s ease;
}

.nav-link.active span:last-child {
    color: var(--gold-primary) !important;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
}

.nav-link i {
    margin-right: 16px; /* Increased spacing */
    font-size: 1.2rem;
    width: 24px;
    text-align: center;
    color: inherit; /* Inherit color from parent */
    transition: all 0.3s ease;
}

.nav-link.active i {
    color: var(--gold-primary);
    transform: scale(1.1);
}

.nav-badge {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    color: white;
    border-radius: 20px;
    width: 24px; /* Slightly larger */
    height: 24px;
    font-size: 0.75rem;
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    right: 16px;
    top: 50%;
    transform: translateY(-50%);
    font-weight: 700;
    box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
}

.side-footer {
    padding: 24px 20px;
    border-top: 1px solid rgba(255, 215, 0, 0.1);
    color: var(--text-muted);
    font-size: 0.85rem;
    background: rgba(10, 10, 10, 0.8);
    backdrop-filter: blur(10px);
}

/* Scrollbar styling for sidebar */
.nav::-webkit-scrollbar {
    width: 4px;
}

.nav::-webkit-scrollbar-track {
    background: transparent;
}

.nav::-webkit-scrollbar-thumb {
    background: rgba(255, 215, 0, 0.3);
    border-radius: 10px;
}

.nav::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 215, 0, 0.5);
}

/* Enhanced logout button */
.nav-link.logout-btn {
    margin-top: auto;
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.2);
    color: #ef4444;
}

.nav-link.logout-btn:hover {
    background: rgba(239, 68, 68, 0.2);
    color: #ef4444;
    border-color: rgba(239, 68, 68, 0.4);
}

/* Responsive adjustments */
@media (max-width: 1200px) {
    .sidebar {
        width: 90px;
    }
    
    .sidebar .brand-text,
    .sidebar .nav-link span:last-child,
    .sidebar .side-footer .kv {
        display: none;
    }
    
    .sidebar .brand {
        justify-content: center;
        padding: 20px 10px;
    }
    
    .sidebar .nav-link {
        justify-content: center;
        padding: 16px;
        margin: 0 12px;
    }
    
    .sidebar .nav-link i {
        margin-right: 0;
        font-size: 1.3rem;
    }
    
    .sidebar .nav-link:hover {
        transform: translateY(-2px);
    }
    
    main {
        margin-left: 90px;
    }
}
.form-group label::after {
    content: " *";
    color: #ef4444;
}

.form-control:required {
    border-left: 3px solid #f59e0b;
}

.form-control:required:valid {
    border-left: 3px solid #10b981;
}

/* Animation for nav items */
@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateX(-20px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

.nav-link {
    animation: slideIn 0.3s ease forwards;
}

.nav-link:nth-child(1) { animation-delay: 0.1s; }
.nav-link:nth-child(2) { animation-delay: 0.15s; }
.nav-link:nth-child(3) { animation-delay: 0.2s; }
.nav-link:nth-child(4) { animation-delay: 0.25s; }
.nav-link:nth-child(5) { animation-delay: 0.3s; }
.nav-link:nth-child(6) { animation-delay: 0.35s; }
.nav-link:nth-child(7) { animation-delay: 0.4s; }
.nav-link:nth-child(8) { animation-delay: 0.45s; }
.nav-link:nth-child(9) { animation-delay: 0.5s; }
.nav-link:nth-child(10) { animation-delay: 0.55s; }
.nav-link:nth-child(11) { animation-delay: 0.6s; }
/* Enhanced Modal Styles */
.modal-backdrop {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  padding: 20px;
}

.modal-content-large {
  background: var(--bg-card);
  border-radius: 12px;
  max-width: 90%;
  max-height: 90vh;
  overflow-y: auto;
  position: relative;
  width: 800px;
  border: 1px solid var(--border-color);
  box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
}

.modal-header {
  padding: 20px 24px;
  border-bottom: 1px solid var(--border-color);
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: var(--bg-secondary);
  border-radius: 12px 12px 0 0;
}

.modal-header h3 {
  margin: 0;
  color: var(--text-primary);
  font-size: 1.5rem;
  font-weight: 700;
}

.modal-close {
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: var(--text-muted);
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
}

.modal-close:hover {
  background: var(--bg-hover);
  color: var(--text-primary);
}

.modal-body {
  padding: 24px;
}

.modal-footer {
  padding: 20px 24px;
  border-top: 1px solid var(--border-color);
  display: flex;
  gap: 12px;
  justify-content: flex-end;
  background: var(--bg-secondary);
  border-radius: 0 0 12px 12px;
}

/* Detail Grid Styles */
.detail-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  margin-bottom: 24px;
}

.detail-item {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.detail-label {
  font-weight: 600;
  color: var(--text-secondary);
  font-size: 0.875rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.detail-value {
  color: var(--text-primary);
  font-size: 1rem;
  padding: 12px;
  background: var(--bg-secondary);
  border-radius: 8px;
  border: 1px solid var(--border-color);
  min-height: 44px;
  display: flex;
  align-items: center;
}

.detail-section {
  margin-bottom: 24px;
  padding: 20px;
  background: var(--bg-secondary);
  border-radius: 8px;
  border: 1px solid var(--border-color);
}

.detail-section-title {
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 16px;
  font-size: 1.1rem;
  display: flex;
  align-items: center;
  gap: 8px;
}

/* Edit Form Styles */
.edit-form {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
}

.form-full-width {
  grid-column: 1 / -1;
}

/* Status Indicators */
.status-indicator {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 0.875rem;
  font-weight: 600;
}

.status-active {
  background: rgba(16, 185, 129, 0.1);
  color: #10b981;
  border: 1px solid rgba(16, 185, 129, 0.3);
}

.status-pending {
  background: rgba(245, 158, 11, 0.1);
  color: #f59e0b;
  border: 1px solid rgba(245, 158, 11, 0.3);
}

.status-suspended {
  background: rgba(239, 68, 68, 0.1);
  color: #ef4444;
  border: 1px solid rgba(239, 68, 68, 0.3);
}

/* User Avatar in Modal */
.user-avatar-modal {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--gold-primary), var(--gold-secondary));
  color: #000;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 2rem;
  margin: 0 auto 20px;
}

/* Skills and Tags */
.skills-container {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 8px;
}

.skill-tag {
  background: var(--bg-primary);
  color: var(--text-primary);
  padding: 4px 12px;
  border-radius: 16px;
  font-size: 0.875rem;
  border: 1px solid var(--border-color);
}

/* Loading State */
.modal-loading {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 60px;
  color: var(--text-muted);
}

.modal-loading i {
  font-size: 2rem;
  margin-bottom: 16px;
}
</style>
</head>
<body>
  <div class="app">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">OL</div>
        <div class="brand-text">
          <div class="title">OpusLink</div>
          <div class="subtitle">Admin Panel</div>
        </div>
      </div>

      <nav class="nav">
        <a href="#" class="nav-link active" data-section="overview">
          <i class="fas fa-chart-line"></i>
          <span>Dashboard</span>
        </a>
        <a href="#" class="nav-link" data-section="users">
          <i class="fas fa-users"></i>
          <span>User Management</span>
          <span class="nav-badge">3</span>
        </a>
        <a href="#" class="nav-link" data-section="admin-management">
          <i class="fas fa-crown"></i>
          <span>Admin Management</span>
        </a>
        <a href="#" class="nav-link" data-section="jobs">
          <i class="fas fa-briefcase"></i>
          <span>Job Management</span>
          <span class="nav-badge">2</span>
        </a>
        <a href="#" class="nav-link" data-section="payments">
          <i class="fas fa-money-bill-wave"></i>
          <span>Payment Overview</span>
        </a>
      <!--  <a href="#" class="nav-link" data-section="reports">
          <i class="fas fa-chart-bar"></i>
          <span>Analytics & Reports</span>
        </a> -->
        <a href="#" class="nav-link" data-section="system">
          <i class="fas fa-cog"></i>
          <span>System Settings</span>
        </a>
        <a href="#" class="nav-link" data-section="moderation">
          <i class="fas fa-shield-alt"></i>
          <span>Content Moderation</span>
          <span class="nav-badge">1</span>
        </a>
        <a href="#" class="nav-link" data-section="verification">
          <i class="fas fa-user-check"></i>
          <span>Verification Queue</span>
          <span class="nav-badge">2</span>
        </a>
        <a href="#" class="nav-link" data-section="notifications">
          <i class="fas fa-bell"></i>
          <span>Notifications</span>
          <span class="nav-badge">5</span>
        </a>
        <a href="#" class="nav-link logout-btn">
          <i class="fas fa-sign-out-alt"></i>
          <span>Logout</span>
        </a>
      </nav>

      <div class="side-footer">
        <div class="kv">Admin since <strong id="adminSince">2024</strong></div>
      </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main>
      <div class="topbar">
        <div class="searchbar">
          <i class="fas fa-search"></i>
          <input id="adminSearch" placeholder="Search users, jobs, transactions..." />
        </div>
        
        <div class="notification-wrapper">
          <button class="notification-btn">
            <i class="fas fa-bell"></i>
          </button>
          <span class="notification-badge">5</span>
        </div>
        
        <div class="user-info">
          <div class="user-details">
            <div class="user-name" id="adminName">Administrator</div>
            <div class="user-role" id="adminEmail">admin@opuslink.com</div>
          </div>
          <div class="avatar">A</div>
        </div>
      </div>

      <div class="content">
        <!-- DASHBOARD OVERVIEW -->
        <section id="overview" class="dashboard-section active">
          <div class="admin-section-title">
            <span>Dashboard Overview</span>
            <a href="#" class="view-all-link">View Full Report →</a>
          </div>

          <!-- Statistics Grid -->
          <div class="admin-stats-grid">
            <div class="admin-stat-card">
              <div class="stat-label">Total Users</div>
              <div class="stat-value">2,847</div>
              <div class="stat-change change-positive">+12% this month</div>
            </div>
            <div class="admin-stat-card">
              <div class="stat-label">Active Jobs</div>
              <div class="stat-value">156</div>
              <div class="stat-change change-positive">+8% this month</div>
            </div>
            <div class="admin-stat-card success">
              <div class="stat-label">Completed Hires</div>
              <div class="stat-value">89</div>
              <div class="stat-change change-positive">+15% this month</div>
            </div>
            <div class="admin-stat-card warning">
              <div class="stat-label">Pending Moderation</div>
              <div class="stat-value">23</div>
              <div class="stat-change change-negative">+5% this week</div>
            </div>
            <div class="admin-stat-card">
              <div class="stat-label">Total Revenue</div>
              <div class="stat-value">₹2.4M</div>
              <div class="stat-change change-positive">+18% this month</div>
            </div>
            <div class="admin-stat-card critical">
              <div class="stat-label">System Issues</div>
              <div class="stat-value">3</div>
              <div class="stat-change change-negative">+2 today</div>
            </div>
          </div>
          

          <!-- Charts and Metrics -->
          <div class="charts-grid">
            <div class="chart-container">
              <h3>Platform Growth</h3>
              <div class="chart-placeholder">
                User Growth & Job Postings Chart
              </div>
            </div>
            <div class="chart-container">
              <h3>Revenue Overview</h3>
              <div class="chart-placeholder">
                Revenue Breakdown Chart
              </div>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="admin-section-title">
            <span>Quick Actions</span>
          </div>
          <div class="quick-actions-grid">
            <div class="quick-action-card" onclick="AdminDashboard.showSection('users')">
              <span class="action-icon"><i class="fas fa-users"></i></span>
              <div class="action-title">Manage Users</div>
              <div class="action-desc">View and manage all users</div>
            </div>
            <div class="quick-action-card" onclick="AdminDashboard.showSection('moderation')">
              <span class="action-icon"><i class="fas fa-shield-alt"></i></span>
              <div class="action-title">Moderate Jobs</div>
              <div class="action-desc">Review pending job posts</div>
            </div>
            <div class="quick-action-card" onclick="AdminDashboard.showSection('payments')">
              <span class="action-icon"><i class="fas fa-money-bill-wave"></i></span>
              <div class="action-title">Payment Review</div>
              <div class="action-desc">Process pending payments</div>
            </div>
            <div class="quick-action-card" onclick="AdminDashboard.showSection('reports')">
              <span class="action-icon"><i class="fas fa-chart-bar"></i></span>
              <div class="action-title">Generate Reports</div>
              <div class="action-desc">Create analytics reports</div>
            </div>
            <div class="quick-action-card" onclick="AdminDashboard.showSection('system')">
              <span class="action-icon"><i class="fas fa-cog"></i></span>
              <div class="action-title">System Settings</div>
              <div class="action-desc">Configure platform settings</div>
            </div>
            <div class="quick-action-card" onclick="AdminDashboard.showSection('admin-management')">
              <span class="action-icon"><i class="fas fa-crown"></i></span>
              <div class="action-title">Admin Management</div>
              <div class="action-desc">Manage administrator accounts</div>
            </div>
          </div>

          <!-- Recent Activity & System Health -->
          <div class="grid-2">
            <div class="recent-activity">
              <div class="admin-section-title">
                <span>Recent Activity</span>
                <a href="#" class="view-all-link">View All</a>
              </div>
              <div class="activity-list">
                <div class="activity-item">
                  <div class="activity-icon user">
                    <i class="fas fa-user-plus"></i>
                  </div>
                  <div class="activity-content">
                    <div class="activity-title">New employer registered</div>
                    <div class="activity-desc">TechCorp Solutions joined the platform</div>
                    <div class="activity-time">2 minutes ago</div>
                  </div>
                </div>
                <div class="activity-item">
                  <div class="activity-icon job">
                    <i class="fas fa-briefcase"></i>
                  </div>
                  <div class="activity-content">
                    <div class="activity-title">Job posted for moderation</div>
                    <div class="activity-desc">Senior Developer position awaiting approval</div>
                    <div class="activity-time">15 minutes ago</div>
                  </div>
                </div>
                <div class="activity-item">
                  <div class="activity-icon payment">
                    <i class="fas fa-money-bill-wave"></i>
                  </div>
                  <div class="activity-content">
                    <div class="activity-title">Payment processed</div>
                    <div class="activity-desc">Escrow release for completed project</div>
                    <div class="activity-time">1 hour ago</div>
                  </div>
                </div>
                <div class="activity-item">
                  <div class="activity-icon alert">
                    <i class="fas fa-exclamation-triangle"></i>
                  </div>
                  <div class="activity-content">
                    <div class="activity-title">System alert</div>
                    <div class="activity-desc">High server load detected</div>
                    <div class="activity-time">2 hours ago</div>
                  </div>
                </div>
              </div>
            </div>

            <div class="system-health">
              <div class="admin-section-title">
                <span>System Health</span>
              </div>
              <div class="health-list">
                <div class="health-indicator">
                  <div class="health-status healthy"></div>
                  <div class="health-info">
                    <div class="health-title">Web Server</div>
                    <div class="health-desc">Response time: 120ms</div>
                  </div>
                </div>
                <div class="health-indicator">
                  <div class="health-status healthy"></div>
                  <div class="health-info">
                    <div class="health-title">Database</div>
                    <div class="health-desc">Active connections: 24</div>
                  </div>
                </div>
                <div class="health-indicator">
                  <div class="health-status warning"></div>
                  <div class="health-info">
                    <div class="health-title">Payment Gateway</div>
                    <div class="health-desc">Higher than usual latency</div>
                  </div>
                </div>
                <div class="health-indicator">
                  <div class="health-status healthy"></div>
                  <div class="health-info">
                    <div class="health-title">File Storage</div>
                    <div class="health-desc">Storage used: 65%</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

    <!-- USER MANAGEMENT SECTION -->
    <section id="users" class="dashboard-section">
      <div class="card">
        <div class="section-title">
          <div>
            <h2>User Management</h2>
            <div class="section-subtitle">Manage all users, employers, and workers</div>
          </div>
          <div class="section-actions">
            <button class="btn btn-ghost" onclick="AdminDashboard.exportData()">
              <i class="fas fa-download"></i> Export
            </button>
          </div>
        </div>
        <div class="table-responsive">
          <table class="data-table">
            <thead>
              <tr>
                <th>User ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>Status</th>
                <th>Profile</th>
                <th>Join Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="usersTableBody">
              <!-- Users will be populated dynamically -->
            </tbody>
          </table>
        </div>
      </div>
    </section>

<!-- ADMIN MANAGEMENT SECTION -->
<section id="admin-management" class="dashboard-section">
  <div class="card">
    <div class="section-title">
      <div>
        <h2>Admin Management</h2>
        <div class="section-subtitle">Create and manage administrator accounts</div>
      </div>
      <div class="section-actions">
        <button class="btn btn-primary" onclick="AdminDashboard.toggleAdminForm()">
          <i class="fas fa-plus"></i> New Admin
        </button>
      </div>
    </div>

    <!-- Create New Admin Form -->
    <div class="form-card" id="adminFormCard" style="display: none;">
      <h4>Create New Administrator</h4>
      <form id="createAdminForm">
         <div class="form-grid">
        <div class="form-group">
            <label for="newAdminFullName">Full Name *</label>
            <input type="text" id="newAdminFullName" class="form-control" placeholder="Enter full name">
        </div>
        <div class="form-group">
            <label for="newAdminEmail">Email Address *</label>
            <input type="email" id="newAdminEmail" class="form-control" placeholder="Enter email address">
        </div>
    </div>
    <div class="form-grid">
        <div class="form-group">
            <label for="newAdminPassword">Password *</label>
            <input type="password" id="newAdminPassword" class="form-control" placeholder="Create secure password">
        </div>
        <div class="form-group">
            <label for="newAdminRole">Admin Role *</label>
            <select id="newAdminRole" class="form-control">
                <option value="">Select a role</option>
                <option value="super_admin">Super Administrator</option>
                <option value="admin">Administrator</option>
                <option value="moderator">Moderator</option>
                <option value="support">Support Admin</option>
            </select>
        </div>
    </div>
        <div class="form-group">
          <label for="adminPermissions">Permissions</label>
          <div class="permissions-grid">
            <label class="checkbox-label">
              <input type="checkbox" name="permissions" value="user_management" checked> User Management
            </label>
            <label class="checkbox-label">
              <input type="checkbox" name="permissions" value="content_moderation" checked> Content Moderation
            </label>
            <label class="checkbox-label">
              <input type="checkbox" name="permissions" value="payment_management" checked> Payment Management
            </label>
            <label class="checkbox-label">
              <input type="checkbox" name="permissions" value="system_settings" checked> System Settings
            </label>
            <label class="checkbox-label">
              <input type="checkbox" name="permissions" value="reports" checked> Reports & Analytics
            </label>
            <label class="checkbox-label">
              <input type="checkbox" name="permissions" value="admin_management" checked> Admin Management
            </label>
          </div>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-user-plus"></i> Create Admin Account
          </button>
          <button type="button" class="btn btn-ghost" onclick="AdminDashboard.toggleAdminForm()">
            Cancel
          </button>
        </div>
      </form>
    </div>

    <!-- Existing Admins List -->
    <div class="table-responsive">
      <table class="data-table">
        <thead>
          <tr>
            <th>Admin ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Role</th>
            <th>Status</th>
            <th>Last Login</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="adminsTableBody">
          <tr>
            <td>ADM-001</td>
            <td>System Administrator</td>
            <td>admin@opuslink.com</td>
            <td><span class="role-badge role-admin">Super Admin</span></td>
            <td><span class="status-badge status-active">Active</span></td>
            <td>2024-01-20 14:30</td>
            <td>
              <div class="admin-actions">
                <button class="btn btn-sm btn-ghost" onclick="AdminDashboard.viewAdmin('ADM-001')">
                  <i class="fas fa-eye"></i> View
                </button>
                <button class="btn btn-sm btn-ghost" disabled>
                  <i class="fas fa-edit"></i> Edit
                </button>
              </div>
            </td>
          </tr>
          <tr>
            <td>ADM-002</td>
            <td>Content Moderator</td>
            <td>moderator@opuslink.com</td>
            <td><span class="role-badge role-admin">Moderator</span></td>
            <td><span class="status-badge status-active">Active</span></td>
            <td>2024-01-19 09:15</td>
            <td>
              <div class="admin-actions">
                <button class="btn btn-sm btn-ghost" onclick="AdminDashboard.viewAdmin('ADM-002')">
                  <i class="fas fa-eye"></i> View
                </button>
                <button class="btn btn-sm btn-ghost" onclick="AdminDashboard.editAdmin('ADM-002')">
                  <i class="fas fa-edit"></i> Edit
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</section>

    <!-- JOB MANAGEMENT SECTION -->
    <section id="jobs" class="dashboard-section">
      <div class="card">
        <div class="section-title">
          <div>
            <h2>Job Management</h2>
            <div class="section-subtitle">Manage all job postings and applications</div>
          </div>
          <div class="section-actions">
            <button class="btn btn-ghost" onclick="AdminDashboard.exportJobsData()">
              <i class="fas fa-download"></i> Export
            </button>
          </div>
        </div>
        <div class="table-responsive">
          <table class="data-table">
            <thead>
              <tr>
                <th>Job ID</th>
                <th>Title</th>
                <th>Company</th>
                <th>Category</th>
                <th>Status</th>
                <th>Applications</th>
                <th>Posted Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="jobsTableBody">
              <!-- Jobs will be populated dynamically -->
            </tbody>
          </table>
        </div>
      </div>
    </section>

<!-- PAYMENT OVERVIEW SECTION -->
<section id="payments" class="dashboard-section">
  <div class="card">
    <div class="section-title">
      <div>
        <h2>Payment Overview</h2>
        <div class="section-subtitle">Manage all transactions and payments</div>
      </div>
      <div class="section-actions">
        <button class="btn btn-primary" onclick="AdminDashboard.exportPaymentsData()">
          <i class="fas fa-download"></i> Export Payments
        </button>
        <button class="btn btn-success" onclick="AdminDashboard.generatePaymentReport()">
          <i class="fas fa-chart-bar"></i> Generate Report
        </button>
        <button class="btn btn-primary" onclick="AdminDashboard.retrieveAllPaymentsFromAgreements()">
          <i class="fas fa-sync"></i> Load Payments
        </button>
        <button class="btn btn-success" onclick="AdminDashboard.showFilterState()">
          <i class="fas fa-filter"></i> Check Filters
        </button>
        <button class="btn btn-info" onclick="AdminDashboard.resetPaymentFilters(); AdminDashboard.filterPayments();">
          <i class="fas fa-eye"></i> Show All
        </button>
        <button class="btn btn-warning" onclick="AdminDashboard.verifyAndFixStatistics()">
          <i class="fas fa-wrench"></i> Fix Stats
        </button>
      </div>
    </div>

    <!-- Payment Statistics -->
    <div class="admin-stats-grid" style="margin-bottom: 24px;">
      <div class="admin-stat-card">
        <div class="stat-label">Total Revenue</div>
        <div class="stat-value" id="totalRevenue">₹0</div>
        <div class="stat-change" id="revenueChange">All time earnings</div>
      </div>
      <div class="admin-stat-card success">
        <div class="stat-label">Completed Payments</div>
        <div class="stat-value" id="completedPayments">0</div>
        <div class="stat-change">Successfully processed</div>
      </div>
      <div class="admin-stat-card warning">
        <div class="stat-label">Pending Payments</div>
        <div class="stat-value" id="pendingPayments">0</div>
        <div class="stat-change">Awaiting processing</div>
      </div>
      <div class="admin-stat-card">
        <div class="stat-label">Failed Payments</div>
        <div class="stat-value" id="failedPayments">0</div>
        <div class="stat-change">Requires attention</div>
      </div>
    </div>

    <!-- Payment Filters -->
    <div class="form-card" style="margin-bottom: 24px;">
      <div class="form-grid">
        <div class="form-group">
          <label for="paymentStatusFilter">Status Filter</label>
          <select id="paymentStatusFilter" class="form-control" onchange="AdminDashboard.filterPayments()">
            <option value="all">All Statuses</option>
            <option value="completed">Completed</option>
            <option value="pending">Pending</option>
            <option value="failed">Failed</option>
            <option value="refunded">Refunded</option>
          </select>
        </div>
        <div class="form-group">
          <label for="paymentTypeFilter">Type Filter</label>
          <select id="paymentTypeFilter" class="form-control" onchange="AdminDashboard.filterPayments()">
            <option value="all">All Types</option>
            <option value="escrow_deposit">Escrow Deposit</option>
            <option value="payout">Payout</option>
            <option value="subscription">Subscription</option>
            <option value="refund">Refund</option>
          </select>
        </div>
        <div class="form-group">
          <label for="paymentDateFilter">Date Range</label>
          <select id="paymentDateFilter" class="form-control" onchange="AdminDashboard.filterPayments()">
            <option value="all">All Time</option>
            <option value="today">Today</option>
            <option value="week">This Week</option>
            <option value="month">This Month</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Payments Table -->
    <div class="table-responsive">
      <table class="data-table">
        <thead>
          <tr>
            <th>Transaction ID</th>
            <th>User</th>
            <th>Type</th>
            <th>Amount</th>
            <th>Status</th>
            <th>Date</th>
            <th>Payment Method</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="paymentsTableBody">
          <!-- Payments will be populated dynamically -->
        </tbody>
      </table>
    </div>
  </div>
</section>

        <!-- REPORTS SECTION -->
        <section id="reports" class="dashboard-section">
          <div class="card">
            <div class="section-title">
              <div>
                <h2>Analytics & Reports</h2>
                <div class="section-subtitle">Platform analytics and performance reports</div>
              </div>
              <div class="section-actions">
                <button class="btn btn-primary">
                  <i class="fas fa-download"></i> Export Report
                </button>
              </div>
            </div>
            <div class="grid-2">
              <div class="chart-container">
                <h3>User Registration Trends</h3>
                <div class="chart-placeholder">
                  User Registration Chart
                </div>
              </div>
              <div class="chart-container">
                <h3>Job Categories Distribution</h3>
                <div class="chart-placeholder">
                  Job Categories Pie Chart
                </div>
              </div>
            </div>
            <div class="grid-3">
              <div class="chart-container">
                <h3>Revenue by Month</h3>
                <div class="chart-placeholder">
                  Monthly Revenue Chart
                </div>
              </div>
              <div class="chart-container">
                <h3>User Activity</h3>
                <div class="chart-placeholder">
                  User Activity Heatmap
                </div>
              </div>
              <div class="chart-container">
                <h3>Platform Performance</h3>
                <div class="chart-placeholder">
                  Performance Metrics
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- SYSTEM SETTINGS SECTION -->
        <section id="system" class="dashboard-section">
          <div class="card">
            <div class="section-title">
              <div>
                <h2>System Settings</h2>
                <div class="section-subtitle">Configure platform-wide settings</div>
              </div>
            </div>
            <form id="systemSettingsForm">
              <div class="form-card">
                <h4>General Settings</h4>
                <div class="form-grid">
                  <div class="form-group">
                    <label for="siteName">Site Name</label>
                    <input type="text" id="siteName" class="form-control" value="OpusLink" required>
                  </div>
                  <div class="form-group">
                    <label for="siteEmail">Site Email</label>
                    <input type="email" id="siteEmail" class="form-control" value="contact@opuslink.com" required>
                  </div>
                </div>
                <div class="form-group">
                  <label for="siteDescription">Site Description</label>
                  <textarea id="siteDescription" class="form-control" rows="3">Connecting talent with opportunity</textarea>
                </div>
              </div>

              <div class="form-card">
                <h4>Payment Settings</h4>
                <div class="form-grid">
                  <div class="form-group">
                    <label for="currency">Default Currency</label>
                    <select id="currency" class="form-control">
                      <option value="INR" selected>Indian Rupee (₹)</option>
                      <option value="USD">US Dollar ($)</option>
                      <option value="EUR">Euro (€)</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="commissionRate">Commission Rate (%)</label>
                    <input type="number" id="commissionRate" class="form-control" value="10" min="0" max="50" step="0.5">
                  </div>
                </div>
                <div class="form-group">
                  <label class="checkbox-label">
                    <input type="checkbox" name="autoApprovePayments" checked> Auto-approve payments under ₹5,000
                  </label>
                </div>
              </div>

              <div class="form-card">
                <h4>Security Settings</h4>
                <div class="form-grid">
                  <div class="form-group">
                    <label for="sessionTimeout">Session Timeout (minutes)</label>
                    <input type="number" id="sessionTimeout" class="form-control" value="60" min="15" max="480">
                  </div>
                  <div class="form-group">
                    <label for="maxLoginAttempts">Max Login Attempts</label>
                    <input type="number" id="maxLoginAttempts" class="form-control" value="5" min="3" max="10">
                  </div>
                </div>
                <div class="form-group">
                  <label class="checkbox-label">
                    <input type="checkbox" name="twoFactorAuth" checked> Require two-factor authentication for admins
                  </label>
                </div>
              </div>

              <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-save"></i> Save Settings
                </button>
                <button type="reset" class="btn btn-ghost">
                  Reset to Defaults
                </button>
              </div>
            </form>
          </div>
        </section>

        <!-- CONTENT MODERATION SECTION -->
        <section id="moderation" class="dashboard-section">
          <div class="card">
            <div class="section-title">
              <div>
                <h2>Content Moderation</h2>
                <div class="section-subtitle">Review and moderate platform content</div>
              </div>
              <div class="section-actions">
                <button class="btn btn-primary">
                  <i class="fas fa-filter"></i> Filter
                </button>
              </div>
            </div>
            <div class="table-responsive">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Content ID</th>
                    <th>Type</th>
                    <th>User</th>
                    <th>Reason</th>
                    <th>Status</th>
                    <th>Reported Date</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>MOD-001</td>
                    <td>Job Post</td>
                    <td>Mike Johnson</td>
                    <td>Inappropriate content</td>
                    <td><span class="status-badge status-pending">Pending</span></td>
                    <td>2024-01-20</td>
                    <td>
                      <div class="admin-actions">
                        <button class="btn btn-sm btn-ghost" onclick="AdminDashboard.viewModeration('MOD-001')">
                          <i class="fas fa-eye"></i> Review
                        </button>
                        <button class="btn btn-sm btn-success" onclick="AdminDashboard.approveContent('MOD-001')">
                          <i class="fas fa-check"></i> Approve
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="AdminDashboard.rejectContent('MOD-001')">
                          <i class="fas fa-times"></i> Reject
                        </button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- VERIFICATION QUEUE SECTION -->
        <section id="verification" class="dashboard-section">
          <div class="card">
            <div class="section-title">
              <div>
                <h2>User Verification Queue</h2>
                <div class="section-subtitle">Approve or reject user verification requests</div>
              </div>
              <div class="section-actions">
                <button class="btn btn-primary" onclick="AdminDashboard.bulkApproveVerifications()">
                  <i class="fas fa-check-double"></i> Bulk Approve
                </button>
              </div>
            </div>
            
            <div class="verification-stats">
              <div class="stat-card">
                <div class="stat-value" id="pendingVerifications">2</div>
                <div class="stat-label">Pending Verification</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="verifiedUsers">1,245</div>
                <div class="stat-label">Verified Users</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="totalUsers">2,847</div>
                <div class="stat-label">Total Users</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="rejectedUsers">42</div>
                <div class="stat-label">Rejected Users</div>
              </div>
            </div>
            
            <div id="verification-queue">
              <div class="verification-item">
                <div class="verification-item-content">
                  <div class="user-avatar-large">J</div>
                  <div class="verification-details">
                    <h4>Jane Smith</h4>
                    <div class="user-meta">
                      <span>jane@dev.com</span>
                      <span class="role-badge role-worker">Worker</span>
                      <span>Requested: 2024-01-20</span>
                    </div>
                    <div class="verification-stats">
                      <span class="stat-tag profile-completion">
                        <i class="fas fa-chart-pie"></i> Profile: 65% Complete
                      </span>
                      <span class="stat-tag skills">
                        <i class="fas fa-tools"></i> JavaScript, React, Node.js
                      </span>
                    </div>
                  </div>
                </div>
                <div class="verification-actions">
                  <button class="btn btn-success btn-sm" onclick="AdminDashboard.approveVerification('USR-002')">
                    <i class="fas fa-check"></i> Approve
                  </button>
                  <button class="btn btn-warning btn-sm" onclick="AdminDashboard.requestMoreInfo('USR-002')">
                    <i class="fas fa-info-circle"></i> Request Info
                  </button>
                  <button class="btn btn-danger btn-sm" onclick="AdminDashboard.rejectVerification('USR-002')">
                    <i class="fas fa-times"></i> Reject
                  </button>
                  <button class="btn btn-ghost btn-sm" onclick="AdminDashboard.viewUserDetails('USR-002')">
                    <i class="fas fa-eye"></i> Details
                  </button>
                </div>
              </div>
              
              <div class="verification-item">
                <div class="verification-item-content">
                  <div class="user-avatar-large">R</div>
                  <div class="verification-details">
                    <h4>Robert Williams</h4>
                    <div class="user-meta">
                      <span>robert@startup.com</span>
                      <span class="role-badge role-employer">Employer</span>
                      <span>Requested: 2024-01-19</span>
                    </div>
                    <div class="verification-stats">
                      <span class="stat-tag profile-completion">
                        <i class="fas fa-chart-pie"></i> Profile: 78% Complete
                      </span>
                      <span class="stat-tag company">
                        <i class="fas fa-building"></i> TechStart Inc.
                      </span>
                    </div>
                  </div>
                </div>
                <div class="verification-actions">
                  <button class="btn btn-success btn-sm" onclick="AdminDashboard.approveVerification('USR-004')">
                    <i class="fas fa-check"></i> Approve
                  </button>
                  <button class="btn btn-warning btn-sm" onclick="AdminDashboard.requestMoreInfo('USR-004')">
                    <i class="fas fa-info-circle"></i> Request Info
                  </button>
                  <button class="btn btn-danger btn-sm" onclick="AdminDashboard.rejectVerification('USR-004')">
                    <i class="fas fa-times"></i> Reject
                  </button>
                  <button class="btn btn-ghost btn-sm" onclick="AdminDashboard.viewUserDetails('USR-004')">
                    <i class="fas fa-eye"></i> Details
                  </button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- NOTIFICATIONS SECTION -->
        <section id="notifications" class="dashboard-section">
          <div class="card">
            <div class="section-title">
              <div>
                <h2>Notifications</h2>
                <div class="section-subtitle">Manage system and user notifications</div>
              </div>
              <div class="section-actions">
                <button class="btn btn-primary">
                  <i class="fas fa-plus"></i> Create Notification
                </button>
              </div>
            </div>
            <div class="table-responsive">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Title</th>
                    <th>Message</th>
                    <th>Type</th>
                    <th>Recipients</th>
                    <th>Status</th>
                    <th>Sent Date</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>NOT-001</td>
                    <td>System Maintenance</td>
                    <td>Planned maintenance on Saturday...</td>
                    <td><span class="status-badge status-pending">System</span></td>
                    <td>All Users</td>
                    <td><span class="status-badge status-active">Sent</span></td>
                    <td>2024-01-18</td>
                    <td>
                      <button class="btn btn-sm btn-ghost">
                        <i class="fas fa-eye"></i> View
                      </button>
                    </td>
                  </tr>
                  <tr>
                    <td>NOT-002</td>
                    <td>New Feature Announcement</td>
                    <td>We've launched a new messaging system...</td>
                    <td><span class="status-badge status-completed">Announcement</span></td>
                    <td>All Users</td>
                    <td><span class="status-badge status-active">Sent</span></td>
                    <td>2024-01-15</td>
                    <td>
                      <button class="btn btn-sm btn-ghost">
                        <i class="fas fa-eye"></i> View
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>

<script>
// Enhanced Admin Dashboard with Real Data Integration
// Complete Admin Dashboard with Real Data Integration
const AdminDashboard = {
    currentData: {
        users: [],
        jobs: [],
        payments: [],
        applications: [],
        employers: [],
        workers: [],
        admins: [],
        reports: [],
        settings: {},
        moderation: [],
        verificationQueue: [],
        notifications: []
    },

    init() {
        console.log('🚀 Initializing Admin Dashboard with Real Data...');
        
        if (!this.checkAdminAuth()) {
            return false;
        }

        this.setupNavigation();
        this.loadAllRealData();
        this.setupAllEventListeners();
        this.setupModalHandlers(); 
        this.updateAdminInfo();
        this.setupSearch();
        this.setupQuickActions();
        this.setupRealTimeUpdates();
        
        
        console.log('✅ Admin Dashboard fully initialized with real data');
        return true;
    },

    // ADD THIS MISSING FUNCTION
    checkAdminAuth() {
        console.log('🔐 Checking admin authentication...');
        
        // For demo purposes, we'll check localStorage for admin user
        try {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            
            if (!currentUser || !currentUser.id) {
                console.log('❌ No user logged in');
                this.showAccessDenied('Please login to access admin dashboard');
                return false;
            }

            if (currentUser.role !== 'admin') {
                console.log('❌ User is not admin, role:', currentUser.role);
                this.showAccessDenied('Admin privileges required');
                return false;
            }

            console.log('✅ Admin authentication successful');
            return true;
        } catch (error) {
            console.error('Authentication error:', error);
            this.showAccessDenied('Authentication error');
            return false;
        }
    },

    // ADD THIS MISSING FUNCTION
    showAccessDenied(message) {
        document.body.innerHTML = `
            <div style="
                display: flex;
                align-items: center;
                justify-content: center;
                min-height: 100vh;
                background: #0a0a0a;
                color: white;
                font-family: system-ui;
                text-align: center;
                padding: 20px;
            ">
                <div>
                    <div style="font-size: 4rem; margin-bottom: 20px;">👑</div>
                    <h1 style="color: #facc15; margin-bottom: 16px; font-size: 2rem;">Admin Access Required</h1>
                    <p style="margin-bottom: 8px; color: #a0a0a0; font-size: 1.1rem;">${message}</p>
                    <div style="display: flex; gap: 12px; justify-content: center;">
                        <button onclick="window.location.href='admin-login.html'" 
                                style="background: #facc15; color: black; border: none; padding: 12px 24px; 
                                       border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1rem;">
                            🔐 Admin Login
                        </button>
                        <button onclick="window.location.href='index.html'" 
                                style="background: #333; color: white; border: none; padding: 12px 24px; 
                                       border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1rem;">
                            🏠 Back to Home
                        </button>
                    </div>
                </div>
            </div>
        `;
    },

// Get all users pending verification
getPendingVerifications() {
    const users = JSON.parse(localStorage.getItem('opuslink_users') || '[]');
    return users.filter(user => user.isVerified !== true);
},

// Approve user verification
approveUserVerification(userId) {
    const users = JSON.parse(localStorage.getItem('opuslink_users') || '[]');
    const userIndex = users.findIndex(u => u.id === userId);
    
    if (userIndex !== -1) {
        users[userIndex].isVerified = true;
        users[userIndex].verificationStatus = 'approved';
        users[userIndex].verifiedAt = new Date().toISOString();
        localStorage.setItem('opuslink_users', JSON.stringify(users));
        return true;
    }
    return false;
},

// Function to reject user verification  
rejectUserVerification(userId) {
    const users = JSON.parse(localStorage.getItem('opuslink_users') || '[]');
    const userIndex = users.findIndex(u => u.id === userId);
    
    if (userIndex !== -1) {
        users.splice(userIndex, 1); // Remove user if rejected
        localStorage.setItem('opuslink_users', JSON.stringify(users));
        return true;
    }
    return false;
},

// Update loadAllRealData to load payments from agreements
loadAllRealData() {
    console.log('📊 Loading real data from localStorage...');
    
    try {
        // Load users data
        this.currentData.users = JSON.parse(localStorage.getItem('opuslink_users') || '[]');
        this.currentData.users = this.currentData.users.map(user => ({
            status: 'active',
            isVerified: false,
            profileCompletion: 0,
            ...user,
            status: user.status || 'active'
        }));
        
        this.currentData.employers = this.currentData.users.filter(user => user.role === 'employer');
        this.currentData.workers = this.currentData.users.filter(user => user.role === 'worker');
        
        // Load jobs data
        this.currentData.jobs = JSON.parse(localStorage.getItem('opuslink_jobs') || '[]');
        this.currentData.jobs = this.currentData.jobs.map(job => ({
            status: 'pending',
            ...job,
            status: job.status || 'pending'
        }));
        
        // Try to load payments from agreements automatically
        const paymentsData = localStorage.getItem('opuslink_payments');
        if (paymentsData) {
            this.currentData.payments = JSON.parse(paymentsData);
            console.log('Loaded existing payments:', this.currentData.payments.length);
        } else {
            // If no payments found, try to load from agreements
            console.log('No payments storage found, checking agreements...');
            this.retrieveAllPaymentsFromAgreements();
        }
        
        // Load other data...
        this.currentData.applications = JSON.parse(localStorage.getItem('opuslink_applications') || '[]');
        this.currentData.notifications = JSON.parse(localStorage.getItem('opuslink_notifications') || '[]');
        
    } catch (error) {
        console.error('❌ Error loading real data:', error);
        this.initializeSampleData();
    }
    
    this.updateAllDashboardData();
},

    // Initialize sample data if no real data exists
    initializeSampleData() {
        console.log('🔄 Initializing sample data...');
        
        // Sample users data
        this.currentData.users = [
            {
                id: 'USR-001',
                fullName: 'John Doe',
                email: 'john@techcorp.com',
                role: 'employer',
                companyName: 'TechCorp Solutions',
                isVerified: true,
                profileCompletion: 85,
                createdAt: '2024-01-15',
                lastLogin: '2024-01-20T14:30:00Z'
            },
            {
                id: 'USR-002',
                fullName: 'Jane Smith',
                email: 'jane@dev.com',
                role: 'worker',
                isVerified: false,
                profileCompletion: 65,
                skills: ['JavaScript', 'React', 'Node.js'],
                createdAt: '2024-01-14',
                lastLogin: '2024-01-19T09:15:00Z'
            },
            {
                id: 'USR-003',
                fullName: 'Mike Johnson',
                email: 'mike@designstudio.com',
                role: 'employer',
                companyName: 'DesignStudio Inc',
                isVerified: true,
                profileCompletion: 92,
                createdAt: '2024-01-13',
                lastLogin: '2024-01-20T16:45:00Z'
            }
        ];
        
        // Sample jobs data
        this.currentData.jobs = [
            {
                id: 'JOB-001',
                title: 'Senior Frontend Developer',
                companyName: 'TechCorp Solutions',
                category: 'Tech & IT',
                status: 'active',
                salary: '₹80,000 - ₹1,20,000',
                applications: 24,
                createdAt: '2024-01-15',
                employerId: 'USR-001'
            },
            {
                id: 'JOB-002',
                title: 'UX/UI Designer',
                companyName: 'DesignStudio Inc',
                category: 'Creative',
                status: 'pending',
                salary: '₹60,000 - ₹90,000',
                applications: 0,
                createdAt: '2024-01-20',
                employerId: 'USR-003'
            }
        ];
        
        // Sample applications data
        this.currentData.applications = [
            {
                id: 'APP-001',
                jobId: 'JOB-001',
                workerId: 'USR-002',
                status: 'pending',
                appliedAt: '2024-01-18',
                coverLetter: 'I am excited to apply for this position...'
            }
        ];
        
        // Sample payments data
        this.currentData.payments = [
            {
                id: 'TXN-001',
                userId: 'USR-001',
                type: 'escrow_deposit',
                amount: 50000,
                status: 'completed',
                createdAt: '2024-01-18'
            },
            {
                id: 'TXN-002',
                userId: 'USR-002',
                type: 'payout',
                amount: 25000,
                status: 'pending',
                createdAt: '2024-01-19'
            }
        ];
        
        this.currentData.employers = this.currentData.users.filter(user => user.role === 'employer');
        this.currentData.workers = this.currentData.users.filter(user => user.role === 'worker');
    },

    // Update all dashboard sections with real data
updateAllDashboardData() {
    this.renderDashboardStats();
    this.renderUsersTable();
    this.renderJobsTable();
    this.renderPaymentsTable(); // Add this line
    this.renderApplicationsTable();
    this.renderVerificationQueue();
    this.updateNavigationBadges();
    this.renderRecentActivity();
},

    // Enhanced Dashboard Stats with Real Data
    renderDashboardStats() {
        console.log('📊 Rendering dashboard stats with real data...');
        
        const totalUsers = this.currentData.users.length;
        const totalEmployers = this.currentData.employers.length;
        const totalWorkers = this.currentData.workers.length;
        const activeJobs = this.currentData.jobs.filter(job => job.status === 'active').length;
        const pendingJobs = this.currentData.jobs.filter(job => job.status === 'pending').length;
        const totalApplications = this.currentData.applications.length;
        const pendingApplications = this.currentData.applications.filter(app => app.status === 'pending').length;
        
        // Calculate total revenue from completed payments
        const totalRevenue = this.currentData.payments
            .filter(payment => payment.status === 'completed')
            .reduce((sum, payment) => sum + (payment.amount || 0), 0);
        
        // Calculate platform metrics
        const verifiedUsers = this.currentData.users.filter(user => user.isVerified).length;
        const pendingVerifications = this.currentData.users.filter(user => !user.isVerified && user.role !== 'admin').length;
        
        const stats = [
            { 
                value: totalUsers, 
                label: 'Total Users', 
                change: `+${totalEmployers} employers, +${totalWorkers} workers`,
                icon: '👥'
            },
            { 
                value: activeJobs, 
                label: 'Active Jobs', 
                change: `${pendingJobs} pending approval`,
                icon: '💼'
            },
            { 
                value: totalApplications, 
                label: 'Total Applications', 
                change: `${pendingApplications} pending review`,
                icon: '📄'
            },
            { 
                value: `₹${this.formatNumber(totalRevenue)}`, 
                label: 'Total Revenue', 
                change: 'All time platform earnings',
                icon: '💰'
            },
            { 
                value: verifiedUsers, 
                label: 'Verified Users', 
                change: `${pendingVerifications} pending verification`,
                icon: '✅'
            },
            { 
                value: this.currentData.notifications.length, 
                label: 'Unread Notifications', 
                change: 'System & user notifications',
                icon: '🔔'
            }
        ];

        const statsContainer = document.querySelector('.admin-stats-grid');
        if (statsContainer) {
            statsContainer.innerHTML = stats.map(stat => `
                <div class="admin-stat-card">
                    <div class="stat-label">${stat.label}</div>
                    <div class="stat-value">${stat.value}</div>
                    <div class="stat-change">${stat.change}</div>
                    <div class="stat-icon">${stat.icon}</div>
                </div>
            `).join('');
        }
    },
// Fix the retrieveAllPaymentsFromAgreements function to properly update statistics
retrieveAllPaymentsFromAgreements() {
    console.log('💰 Retrieving payments from agreements...');
    
    // Get all agreements from localStorage
    const agreements = this.getAllAgreements();
    console.log('Total agreements found:', agreements.length);
    
    let allPayments = [];
    
    // Extract payments from all agreements
    agreements.forEach(agreement => {
        if (agreement.payments && Array.isArray(agreement.payments)) {
            agreement.payments.forEach(payment => {
                // Get user information
                const employer = this.currentData.users.find(u => u.id === agreement.employerId);
                const worker = this.currentData.users.find(u => u.id === agreement.workerId);
                
                allPayments.push({
                    id: payment.id || `PMT-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                    userId: agreement.employerId,
                    receiverId: agreement.workerId,
                    type: 'payout',
                    amount: parseFloat(payment.amount) || 0,
                    status: payment.status || 'completed',
                    paymentMethod: 'Escrow',
                    createdAt: payment.createdAt || payment.date || agreement.createdAt,
                    jobId: agreement.jobId,
                    agreementId: agreement.id,
                    description: `Payment for work: ${agreement.jobTitle}`,
                    employerName: employer?.fullName || 'Unknown Employer',
                    workerName: worker?.fullName || agreement.workerName || 'Unknown Worker',
                    jobTitle: agreement.jobTitle,
                    hours: payment.hours || 0,
                    currency: 'INR'
                });
            });
        }
    });
    
    console.log('Total payments extracted:', allPayments.length);
    
    // Update current data
    this.currentData.payments = allPayments;
    
    // Save to dedicated payments storage
    this.savePaymentsToStorage();
    
    console.log('Payments saved, updating UI...');
    
    // Update statistics FIRST
    this.updatePaymentStatistics();
    
    // Then render the table
    this.renderPaymentsTable();
    
    this.showNotification(`Retrieved ${allPayments.length} payments from agreements`, 'success');
},


// Helper function to get all agreements (similar to your employer dashboard)
getAllAgreements() {
    try {
        // Try different possible storage keys
        const agreementKeys = [
            'opuslink_agreements',
            'work_agreements',
            'job_agreements',
            'employer_agreements',
            'agreements'
        ];
        
        for (const key of agreementKeys) {
            const data = localStorage.getItem(key);
            if (data) {
                const agreements = JSON.parse(data);
                if (Array.isArray(agreements)) {
                    console.log(`Found agreements in ${key}:`, agreements.length);
                    return agreements;
                }
            }
        }
        
        // If no agreements found in dedicated storage, check if they're stored with users
        const usersWithAgreements = this.currentData.users.filter(user => 
            user.agreements && Array.isArray(user.agreements)
        );
        
        if (usersWithAgreements.length > 0) {
            let allUserAgreements = [];
            usersWithAgreements.forEach(user => {
                allUserAgreements = allUserAgreements.concat(user.agreements);
            });
            console.log('Found agreements in user data:', allUserAgreements.length);
            return allUserAgreements;
        }
        
        console.log('No agreements found in any storage location');
        return [];
        
    } catch (error) {
        console.error('Error loading agreements:', error);
        return [];
    }
},
// Add this debug function to check payments data
debugPayments() {
    console.log('=== DEBUG PAYMENTS ===');
    
    // Check if payments section exists
    const paymentsSection = document.getElementById('payments');
    console.log('Payments section exists:', !!paymentsSection);
    
    // Check if payments table body exists
    const paymentsTableBody = document.getElementById('paymentsTableBody');
    console.log('Payments table body exists:', !!paymentsTableBody);
    
    // Check localStorage for payments
    const storedPayments = localStorage.getItem('opuslink_payments');
    console.log('Stored payments in localStorage:', storedPayments);
    
    // Check current data
    console.log('Current payments data:', this.currentData.payments);
    console.log('Current payments length:', this.currentData.payments.length);
    
    // Check if function is being called
    console.log('renderPaymentsTable function exists:', typeof this.renderPaymentsTable === 'function');
    
    console.log('=== END DEBUG ===');
},
    // ADD MISSING NAVIGATION SETUP
    setupNavigation() {
        console.log('Setting up navigation...');
        
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                
                if (link.classList.contains('logout-btn')) {
                    this.logout();
                    return;
                }
                
                const section = link.getAttribute('data-section');
                console.log('Navigation clicked:', section);
                this.showSection(section);
            });
        });

        // Show overview by default
        this.showSection('overview');
    },

    // ADD MISSING LOGOUT FUNCTION
    logout() {
        console.log('👋 Admin logging out...');
        if (confirm('Are you sure you want to logout?')) {
            sessionStorage.removeItem('currentUser');
            localStorage.removeItem('currentUser');
            window.location.href = 'admin-login.html';
        }
    },

    // ADD MISSING SHOW SECTION FUNCTION
    showSection(sectionName) {
        console.log('Showing section:', sectionName);
        
        // Save last visited section
        sessionStorage.setItem('adminLastSection', sectionName);
        
        // Hide all sections
        document.querySelectorAll('.dashboard-section').forEach(section => {
            section.style.display = 'none';
            section.classList.remove('active');
        });
        
        // Remove active class from all nav links
        document.querySelectorAll('.nav-link').forEach(link => {
            link.classList.remove('active');
        });

        // Show target section
        const targetSection = document.getElementById(sectionName);
        if (targetSection) {
            targetSection.style.display = 'block';
            targetSection.classList.add('active');
            console.log('✅ Section activated:', sectionName);
        }

        // Activate nav link
        const targetLink = document.querySelector(`[data-section="${sectionName}"]`);
        if (targetLink) {
            targetLink.classList.add('active');
        }

        // Load section data
        this.loadSectionData(sectionName);
    },

    // ADD MISSING LOAD SECTION DATA FUNCTION
    loadSectionData(sectionName) {
        console.log('Loading data for section:', sectionName);
        
        switch(sectionName) {
            case 'users':
                this.renderUsersTable();
                break;
            case 'jobs':
                this.renderJobsTable();
                break;
            case 'payments':
                this.renderPaymentsTable();
                this.loadPaymentsSection(); 
                break;
            case 'admin-management':
                this.renderAdminUsers(); // Add this line
                break;
            case 'admin-management':
                this.renderAdminUsers();
                break;
            case 'moderation':
                this.renderModerationTable();
                break;
            case 'system':
                this.loadSystemSettings();
                break;
            case 'overview':
                this.renderDashboardStats();
                this.renderRecentActivity();
                this.renderSystemHealth();
                break;
            case 'reports':
                this.renderReports();
                break;
            case 'verification':
                this.renderVerificationQueue();
                break;
            case 'notifications':
                this.renderNotificationsTable();
                break;
        }
    },

    // ADD MISSING EVENT LISTENERS SETUP
    setupEventListeners() {
        console.log('Setting up event listeners...');
        
        // Create Admin Form
        const createAdminForm = document.getElementById('createAdminForm');
        if (createAdminForm) {
            createAdminForm.addEventListener('submit', (e) => {
                e.preventDefault();
                this.createNewAdmin();
            });
        }

        // System Settings Form
        const systemSettingsForm = document.getElementById('systemSettingsForm');
        if (systemSettingsForm) {
            systemSettingsForm.addEventListener('submit', (e) => {
                e.preventDefault();
                this.saveSystemSettings();
            });
        }

        // Search functionality
        this.setupSearch();
    },

    // ADD MISSING SEARCH SETUP
    setupSearch() {
        console.log('Setting up search...');
        const adminSearch = document.getElementById('adminSearch');
        if (adminSearch) {
            let searchTimeout;
            adminSearch.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    const searchTerm = e.target.value.toLowerCase().trim();
                    if (searchTerm.length > 2) {
                        this.searchAllData(searchTerm);
                    } else if (searchTerm.length === 0) {
                        this.resetSearch();
                    }
                }, 300);
            });
        }
    },

    // ADD MISSING QUICK ACTIONS SETUP
    setupQuickActions() {
        console.log('Setting up quick actions...');
        // Actions are handled by onclick attributes in HTML
    },

    // ADD MISSING REAL-TIME UPDATES
    setupRealTimeUpdates() {
        // Simulate real-time updates every 30 seconds
        setInterval(() => {
            this.loadAllRealData();
        }, 30000);
    },

    // ADD MISSING UPDATE ADMIN INFO
    updateAdminInfo() {
        const currentUser = JSON.parse(localStorage.getItem('currentUser') || sessionStorage.getItem('currentUser') || '{}');
        const adminName = document.getElementById('adminName');
        const adminEmail = document.getElementById('adminEmail');
        const adminSince = document.getElementById('adminSince');
        
        if (adminName) adminName.textContent = currentUser.fullName || 'Administrator';
        if (adminEmail) adminEmail.textContent = currentUser.email || 'admin@opuslink.com';
        if (adminSince) adminSince.textContent = new Date().getFullYear();
    },

    renderUsersTable(users = this.currentData.users) {
        const usersTable = document.querySelector('#users tbody');
        if (!usersTable) return;

        if (users.length === 0) {
            usersTable.innerHTML = `
                <tr>
                    <td colspan="8" class="empty-state">
                        <div class="empty-state-icon">👥</div>
                        <h3>No Users Found</h3>
                        <p>Users will appear here when they register</p>
                    </td>
                </tr>
            `;
            return;
        }

        usersTable.innerHTML = users.map(user => {
            const isSuspended = user.status === 'suspended';
            const isActive = !isSuspended && user.isVerified;
            const isPending = !user.isVerified && user.status !== 'suspended';
            
            return `
                <tr>
                    <td>${user.id}</td>
                    <td>
                        <div class="user-info-small">
                            <div class="user-avatar-small">
                                ${(user.fullName || 'U').charAt(0).toUpperCase()}
                            </div>
                            <div>
                                <div class="user-name">${user.fullName || 'Unknown User'}</div>
                                <div class="user-email">${user.email || 'No email'}</div>
                            </div>
                        </div>
                    </td>
                    <td>${user.email}</td>
                    <td>
                        <span class="role-badge role-${user.role}">
                            ${user.role === 'employer' ? '🏢 ' : '👨‍💼 '}${user.role}
                        </span>
                    </td>
                    <td>
                        <span class="status-badge ${isSuspended ? 'status-suspended' : isActive ? 'status-verified' : 'status-pending'}">
                            ${isSuspended ? '⏸️ Suspended' : isActive ? '✅ Active' : '⏳ Pending'}
                        </span>
                    </td>
                    <td>${user.profileCompletion || 0}%</td>
                    <td>${this.formatDate(user.createdAt)}</td>
                    <td>
                        <div class="admin-actions">
                            <button class="btn btn-sm btn-ghost" onclick="AdminDashboard.viewUserDetails('${user.id}')">
                                <i class="fas fa-eye"></i> View
                            </button>
                            ${!isSuspended ? `
                                <button class="btn btn-sm btn-warning" onclick="AdminDashboard.suspendUser('${user.id}')">
                                    <i class="fas fa-pause"></i> Suspend
                                </button>
                            ` : `
                                <button class="btn btn-sm btn-success" onclick="AdminDashboard.activateUser('${user.id}')">
                                    <i class="fas fa-play"></i> Activate
                                </button>
                            `}
                            ${!user.isVerified && !isSuspended ? `
                                <button class="btn btn-sm btn-success" onclick="AdminDashboard.approveVerification('${user.id}')">
                                    <i class="fas fa-check"></i> Verify
                                </button>
                            ` : ''}
                        </div>
                    </td>
                </tr>
            `;
        }).join('');
    },

    // Enhanced Jobs Table with Suspend/Activate Functionality
    renderJobsTable(jobs = this.currentData.jobs) {
        const jobsTable = document.querySelector('#jobs tbody');
        if (!jobsTable) return;

        if (jobs.length === 0) {
            jobsTable.innerHTML = `
                <tr>
                    <td colspan="8" class="empty-state">
                        <div class="empty-state-icon">💼</div>
                        <h3>No Jobs Found</h3>
                        <p>Jobs will appear here when employers post them</p>
                    </td>
                </tr>
            `;
            return;
        }

        jobsTable.innerHTML = jobs.map(job => {
            const employer = this.currentData.users.find(u => u.id === job.employerId);
            const applicationCount = this.currentData.applications.filter(app => app.jobId === job.id).length;
            const isSuspended = job.status === 'suspended';
            const isActive = job.status === 'active';
            const isPending = job.status === 'pending';
            
            return `
                <tr>
                    <td>${job.id}</td>
                    <td>
                        <strong>${job.title}</strong>
                        <div class="text-muted">${job.salary || 'Salary not specified'}</div>
                    </td>
                    <td>${employer ? employer.companyName || employer.fullName : 'Unknown Company'}</td>
                    <td>${job.category || 'General'}</td>
                    <td>
                        <span class="status-badge ${isSuspended ? 'status-suspended' : isActive ? 'status-active' : isPending ? 'status-pending' : 'status-cancelled'}">
                            ${isSuspended ? '⏸️ Suspended' : isActive ? '✅ Active' : isPending ? '⏳ Pending' : '❌ ' + job.status}
                        </span>
                    </td>
                    <td>${applicationCount}</td>
                    <td>${this.formatDate(job.createdAt)}</td>
                    <td>
                        <div class="admin-actions">
                            <button class="btn btn-sm btn-ghost" onclick="AdminDashboard.viewJobDetails('${job.id}')">
                                <i class="fas fa-eye"></i> View
                            </button>
                            ${!isSuspended && job.status !== 'pending' ? `
                                <button class="btn btn-sm btn-warning" onclick="AdminDashboard.suspendJob('${job.id}')">
                                    <i class="fas fa-pause"></i> Suspend
                                </button>
                            ` : ''}
                            ${isSuspended ? `
                                <button class="btn btn-sm btn-success" onclick="AdminDashboard.activateJob('${job.id}')">
                                    <i class="fas fa-play"></i> Activate
                                </button>
                            ` : ''}
                            ${job.status === 'pending' ? `
                                <button class="btn btn-sm btn-success" onclick="AdminDashboard.approveJob('${job.id}')">
                                    <i class="fas fa-check"></i> Approve
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="AdminDashboard.rejectJob('${job.id}')">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                            ` : ''}
                        </div>
                    </td>
                </tr>
            `;
        }).join('');
    },
    renderAdminUsers() {
    const adminsTableBody = document.getElementById('adminsTableBody');
    if (!adminsTableBody) return;

    // Filter only admin users (role includes 'admin', 'super_admin', 'moderator', 'support')
    const adminUsers = this.currentData.users.filter(user => 
        user.role === 'admin' || 
        user.role === 'super_admin' || 
        user.role === 'moderator' || 
        user.role === 'support'
    );

    console.log('Admin users found:', adminUsers);

    if (adminUsers.length === 0) {
        adminsTableBody.innerHTML = `
            <tr>
                <td colspan="7" class="empty-state">
                    <div class="empty-state-icon">👑</div>
                    <h3>No Admin Users Found</h3>
                    <p>Create your first admin user using the "New Admin" button</p>
                </td>
            </tr>
        `;
        return;
    }

    adminsTableBody.innerHTML = adminUsers.map(admin => {
        const roleDisplay = {
            'super_admin': 'Super Admin',
            'admin': 'Administrator', 
            'moderator': 'Moderator',
            'support': 'Support Admin'
        }[admin.role] || admin.role;

        return `
            <tr>
                <td>${admin.id}</td>
                <td>${admin.fullName || 'Unknown'}</td>
                <td>${admin.email}</td>
                <td><span class="role-badge role-admin">${roleDisplay}</span></td>
                <td><span class="status-badge status-active">Active</span></td>
                <td>${this.formatDate(admin.lastLogin) || 'Never'}</td>
                <td>
                    <div class="admin-actions">
                        <button class="btn btn-sm btn-ghost" onclick="AdminDashboard.viewAdmin('${admin.id}')">
                            <i class="fas fa-eye"></i> View
                        </button>
                        ${admin.role !== 'super_admin' ? `
                            <button class="btn btn-sm btn-ghost" onclick="AdminDashboard.editAdmin('${admin.id}')">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                        ` : `
                            <button class="btn btn-sm btn-ghost" disabled>
                                <i class="fas fa-edit"></i> Edit
                            </button>
                        `}
                    </div>
                </td>
            </tr>
        `;
    }).join('');
},

// Update the renderPaymentsTable function to handle agreement payments
renderPaymentsTable(payments = this.currentData.payments) {
    console.log('🔄 Rendering payments table...');
    console.log('Payments to render:', payments);
    
    const paymentsTable = document.getElementById('paymentsTableBody');
    if (!paymentsTable) {
        console.error('❌ paymentsTableBody element not found!');
        return;
    }

    // Update payment statistics
    this.updatePaymentStatistics(payments);

    if (!payments || payments.length === 0) {
        console.log('No payments data, showing empty state');
        paymentsTable.innerHTML = `
            <tr>
                <td colspan="8" class="empty-state">
                    <div class="empty-state-icon">💰</div>
                    <h3>No Payments Found</h3>
                    <p>No payment transactions found in the system.</p>
                    <div style="margin-top: 16px;">
                        <button class="btn btn-primary" onclick="AdminDashboard.retrieveAllPaymentsFromAgreements()">
                            <i class="fas fa-sync"></i> Retrieve Payments from Agreements
                        </button>
                        <button class="btn btn-ghost" onclick="AdminDashboard.debugPayments()" style="margin-left: 8px;">
                            <i class="fas fa-bug"></i> Debug
                        </button>
                    </div>
                </td>
            </tr>
        `;
        return;
    }

    console.log('Rendering', payments.length, 'payments');
    
    paymentsTable.innerHTML = payments.map(payment => {
        console.log('Processing payment:', payment);
        
        const user = this.currentData.users.find(u => u.id === payment.userId);
        const userName = payment.employerName || user?.fullName || 'Unknown User';
        const workerName = payment.workerName || 'Unknown Worker';
        
        const paymentTypeDisplay = {
            'escrow_deposit': 'Escrow Deposit',
            'payout': 'Worker Payout',
            'subscription': 'Subscription',
            'refund': 'Refund',
            'commission': 'Platform Commission'
        }[payment.type] || payment.type;

        const statusBadgeClass = {
            'completed': 'status-completed',
            'pending': 'status-pending',
            'failed': 'status-rejected',
            'refunded': 'status-cancelled'
        }[payment.status] || 'status-pending';

        const statusDisplay = {
            'completed': '✅ Completed',
            'pending': '⏳ Pending',
            'failed': '❌ Failed',
            'refunded': '↩️ Refunded'
        }[payment.status] || payment.status;

        return `
            <tr>
                <td><strong>${payment.id}</strong></td>
                <td>
                    <div class="user-info-small">
                        <div class="user-avatar-small">
                            ${(userName || 'U').charAt(0).toUpperCase()}
                        </div>
                        <div>
                            <div class="user-name">${userName}</div>
                            <div class="user-email">${user?.email || 'Employer'}</div>
                        </div>
                    </div>
                    <div style="margin-top: 8px; font-size: 0.8rem; color: var(--text-muted);">
                        <strong>To:</strong> ${workerName}
                    </div>
                </td>
                <td>
                    <span class="text-capitalize">${paymentTypeDisplay}</span>
                    ${payment.jobTitle ? `<br><small>${payment.jobTitle}</small>` : ''}
                    ${payment.agreementId ? `<br><small style="color: var(--text-muted);">Agreement: ${payment.agreementId}</small>` : ''}
                </td>
                <td><strong>₹${this.formatNumber(payment.amount || 0)}</strong></td>
                <td><span class="status-badge ${statusBadgeClass}">${statusDisplay}</span></td>
                <td>${this.formatDate(payment.createdAt)}</td>
                <td>${payment.paymentMethod || 'Escrow'}</td>
                <td>
                    <div class="admin-actions">
                        <button class="btn btn-sm btn-ghost" onclick="AdminDashboard.viewPaymentDetails('${payment.id}')">
                            <i class="fas fa-eye"></i> View
                        </button>
                        ${payment.status === 'pending' ? `
                            <button class="btn btn-sm btn-primary" onclick="AdminDashboard.processPayment('${payment.id}')">
                                <i class="fas fa-play"></i> Process
                            </button>
                        ` : ''}
                    </div>
                </td>
            </tr>
        `;
    }).join('');
    
    console.log('✅ Payments table rendered');
},

updatePaymentStatistics(payments = this.currentData.payments) {
    console.log('📊 Updating payment statistics with:', payments.length, 'payments');
    
    if (!payments || payments.length === 0) {
        console.log('No payments to calculate statistics');
        return;
    }

    // Calculate statistics
    const totalRevenue = payments
        .filter(p => p.status === 'completed')
        .reduce((sum, payment) => {
            const amount = parseFloat(payment.amount) || 0;
            return sum + amount;
        }, 0);
    
    const completedPayments = payments.filter(p => p.status === 'completed').length;
    const pendingPayments = payments.filter(p => p.status === 'pending').length;
    const failedPayments = payments.filter(p => p.status === 'failed').length;

    console.log('📈 Statistics calculated:', {
        totalRevenue,
        completedPayments,
        pendingPayments,
        failedPayments
    });

    // Update DOM elements with timeout to ensure DOM is ready
    setTimeout(() => {
        this.updateStatElement('totalRevenue', `₹${this.formatNumber(totalRevenue)}`);
        this.updateStatElement('completedPayments', completedPayments);
        this.updateStatElement('pendingPayments', pendingPayments);
        this.updateStatElement('failedPayments', failedPayments);
    }, 100);
},
// Enhanced updateStatElement with visual feedback
updateStatElement(elementId, value) {
    const element = document.getElementById(elementId);
    if (element) {
        console.log(`Updating ${elementId} from "${element.textContent}" to "${value}"`);
        element.textContent = value;
        
        // Add visual feedback
        element.style.transform = 'scale(1.1)';
        element.style.transition = 'transform 0.3s ease';
        setTimeout(() => {
            element.style.transform = 'scale(1)';
        }, 300);
    } else {
        console.error(`❌ Element not found: ${elementId}`);
        
        // Try alternative selectors
        const alternativeElement = document.querySelector(`[data-stat="${elementId}"]`) || 
                                  document.querySelector(`.${elementId}`);
        if (alternativeElement) {
            console.log(`Found alternative element for ${elementId}`);
            alternativeElement.textContent = value;
        }
    }
},
// Manual statistics verification and fix
verifyAndFixStatistics() {
    console.log('🔧 Verifying and fixing statistics...');
    
    const payments = this.currentData.payments;
    console.log('Current payments:', payments);
    
    // Calculate what the statistics SHOULD be
    const totalRevenue = payments
        .filter(p => p.status === 'completed')
        .reduce((sum, payment) => sum + (parseFloat(payment.amount) || 0), 0);
    
    const completedPayments = payments.filter(p => p.status === 'completed').length;
    const pendingPayments = payments.filter(p => p.status === 'pending').length;
    const failedPayments = payments.filter(p => p.status === 'failed').length;

    console.log('Statistics SHOULD be:', {
        totalRevenue: `₹${this.formatNumber(totalRevenue)}`,
        completedPayments,
        pendingPayments,
        failedPayments
    });

    // Get current displayed values
    const currentStats = {
        totalRevenue: document.getElementById('totalRevenue')?.textContent,
        completedPayments: document.getElementById('completedPayments')?.textContent,
        pendingPayments: document.getElementById('pendingPayments')?.textContent,
        failedPayments: document.getElementById('failedPayments')?.textContent
    };

    console.log('Statistics CURRENTLY showing:', currentStats);

    // Force update if different
    if (currentStats.totalRevenue !== `₹${this.formatNumber(totalRevenue)}`) {
        console.log('Fixing total revenue...');
        this.updateStatElement('totalRevenue', `₹${this.formatNumber(totalRevenue)}`);
    }
    
    if (parseInt(currentStats.completedPayments) !== completedPayments) {
        console.log('Fixing completed payments...');
        this.updateStatElement('completedPayments', completedPayments);
    }
    
    if (parseInt(currentStats.pendingPayments) !== pendingPayments) {
        console.log('Fixing pending payments...');
        this.updateStatElement('pendingPayments', pendingPayments);
    }
    
    if (parseInt(currentStats.failedPayments) !== failedPayments) {
        console.log('Fixing failed payments...');
        this.updateStatElement('failedPayments', failedPayments);
    }

    this.showNotification('Statistics verified and fixed', 'success');
},

// Add this function to load payments when section is shown
// Updated loadPaymentsSection function
loadPaymentsSection() {
    console.log('💳 Loading payments section...');
    
    // Setup filters
    this.setupPaymentFilters();
    
    // If we already have payments, just update the display
    if (this.currentData.payments && this.currentData.payments.length > 0) {
        console.log('Using existing payments data');
        this.updatePaymentStatistics();
        this.renderPaymentsTable();
    } else {
        // Otherwise, retrieve payments from agreements
        console.log('No payments data, retrieving from agreements');
        this.retrieveAllPaymentsFromAgreements();
    }
},

// Enhanced filterPayments function
filterPayments() {
    console.log('🔍 Filtering payments...');
    
    const statusFilter = document.getElementById('paymentStatusFilter')?.value || 'all';
    const typeFilter = document.getElementById('paymentTypeFilter')?.value || 'all';
    const dateFilter = document.getElementById('paymentDateFilter')?.value || 'all';

    console.log('Filter values:', { statusFilter, typeFilter, dateFilter });
    console.log('All available payments:', this.currentData.payments);

    let filteredPayments = [...this.currentData.payments];

    // Filter by status
    if (statusFilter !== 'all') {
        filteredPayments = filteredPayments.filter(p => {
            const paymentStatus = p.status?.toLowerCase();
            const filterStatus = statusFilter.toLowerCase();
            return paymentStatus === filterStatus;
        });
        console.log(`After status filter (${statusFilter}):`, filteredPayments.length);
    }

    // Filter by type
    if (typeFilter !== 'all') {
        filteredPayments = filteredPayments.filter(p => {
            const paymentType = p.type?.toLowerCase();
            const filterType = typeFilter.toLowerCase();
            return paymentType === filterType;
        });
        console.log(`After type filter (${typeFilter}):`, filteredPayments.length);
    }

    // Filter by date
    if (dateFilter !== 'all') {
        const now = new Date();
        filteredPayments = filteredPayments.filter(p => {
            if (!p.createdAt) return false;
            
            const paymentDate = new Date(p.createdAt);
            if (isNaN(paymentDate.getTime())) return false;
            
            switch (dateFilter) {
                case 'today':
                    return paymentDate.toDateString() === now.toDateString();
                case 'week':
                    const weekAgo = new Date(now);
                    weekAgo.setDate(now.getDate() - 7);
                    return paymentDate >= weekAgo;
                case 'month':
                    const monthAgo = new Date(now);
                    monthAgo.setMonth(now.getMonth() - 1);
                    return paymentDate >= monthAgo;
                default:
                    return true;
            }
        });
        console.log(`After date filter (${dateFilter}):`, filteredPayments.length);
    }

    console.log('Final filtered payments to display:', filteredPayments);
    
    // Render the table with filtered payments
    this.renderPaymentsTable(filteredPayments);
},
// Show current filter state
showFilterState() {
    const statusFilter = document.getElementById('paymentStatusFilter')?.value || 'all';
    const typeFilter = document.getElementById('paymentTypeFilter')?.value || 'all';
    const dateFilter = document.getElementById('paymentDateFilter')?.value || 'all';
    
    console.log('=== CURRENT FILTER STATE ===');
    console.log('Status Filter:', statusFilter);
    console.log('Type Filter:', typeFilter);
    console.log('Date Filter:', dateFilter);
    console.log('Total Payments:', this.currentData.payments.length);
    
    // Show what should be displayed
    this.filterPayments();
    
    console.log('=== END FILTER STATE ===');
},

// Generate sample payments for testing
generateSamplePayments() {
    console.log('Generating sample payments...');
    
    // Get existing payments to avoid duplicates
    const existingPayments = this.currentData.payments || [];
    const existingIds = existingPayments.map(p => p.id);
    
    const samplePayments = [
        {
            id: 'TXN-' + Date.now(),
            userId: this.currentData.users.find(u => u.role === 'employer')?.id || 'USR-001',
            type: 'escrow_deposit',
            amount: 50000,
            status: 'completed',
            paymentMethod: 'Razorpay',
            createdAt: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
            jobId: 'JOB-001'
        },
        {
            id: 'TXN-' + (Date.now() + 1),
            userId: this.currentData.users.find(u => u.role === 'worker')?.id || 'USR-002',
            type: 'payout',
            amount: 45000,
            status: 'pending',
            paymentMethod: 'Bank Transfer',
            createdAt: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(),
            jobId: 'JOB-001'
        },
        {
            id: 'TXN-' + (Date.now() + 2),
            userId: this.currentData.users.find(u => u.role === 'employer')?.id || 'USR-003',
            type: 'escrow_deposit',
            amount: 75000,
            status: 'completed',
            paymentMethod: 'Razorpay',
            createdAt: new Date().toISOString(),
            jobId: 'JOB-002'
        }
    ].filter(payment => !existingIds.includes(payment.id));

    if (samplePayments.length === 0) {
        this.showNotification('Sample payments already exist!', 'info');
        return;
    }

    // Add sample payments to current data
    this.currentData.payments = [...existingPayments, ...samplePayments];
    
    // Save to localStorage
    this.savePaymentsToStorage();
    
    console.log('Sample payments saved:', this.currentData.payments);
    
    this.showNotification('Sample payments generated successfully!', 'success');
    
    // Force refresh of payments table
    this.renderPaymentsTable();
},
// Enhanced payment processing function
processPaymentData(payments) {
    const processed = [];
    
    payments.forEach((payment, index) => {
        if (!payment) return;
        
        // Normalize payment object with proper status and type
        const normalizedPayment = {
            id: payment.id || payment.transactionId || payment.paymentId || `PMT-${Date.now()}-${index}`,
            userId: payment.userId || payment.userID || payment.employerId,
            receiverId: payment.receiverId || payment.workerId,
            type: this.normalizePaymentType(payment.type || payment.paymentType || 'payout'),
            amount: parseFloat(payment.amount) || 0,
            status: this.normalizePaymentStatus(payment.status || payment.paymentStatus || 'completed'),
            paymentMethod: payment.paymentMethod || payment.method || 'Escrow',
            createdAt: payment.createdAt || payment.date || payment.timestamp || new Date().toISOString(),
            jobId: payment.jobId || payment.jobID,
            agreementId: payment.agreementId,
            description: payment.description || payment.notes || `Payment for work`,
            employerName: payment.employerName,
            workerName: payment.workerName,
            jobTitle: payment.jobTitle,
            hours: payment.hours || 0,
            currency: payment.currency || 'INR'
        };
        
        // Only add valid payments with amount
        if (normalizedPayment.amount > 0) {
            processed.push(normalizedPayment);
        }
    });
    
    // Sort by date (newest first)
    return processed.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
},

// Enhanced payment type normalization
normalizePaymentType(type) {
    if (!type) return 'payout';
    
    const typeMap = {
        'escrow': 'escrow_deposit',
        'deposit': 'escrow_deposit',
        'payout': 'payout',
        'withdrawal': 'payout',
        'payment': 'payout',
        'subscription': 'subscription',
        'refund': 'refund',
        'commission': 'commission',
        'fee': 'commission'
    };
    
    const lowerType = type.toLowerCase().trim();
    return typeMap[lowerType] || 'payout'; // Default to payout
},

// Enhanced payment status normalization
normalizePaymentStatus(status) {
    if (!status) return 'completed';
    
    const statusMap = {
        'success': 'completed',
        'successful': 'completed',
        'completed': 'completed',
        'paid': 'completed',
        'pending': 'pending',
        'processing': 'pending',
        'failed': 'failed',
        'rejected': 'failed',
        'cancelled': 'failed',
        'refunded': 'refunded'
    };
    
    const lowerStatus = status.toLowerCase().trim();
    return statusMap[lowerStatus] || 'completed'; // Default to completed
},

// Payment action functions
processPayment(paymentId) {
    const payment = this.currentData.payments.find(p => p.id === paymentId);
    if (!payment) {
        this.showNotification('Payment not found', 'error');
        return;
    }

    if (confirm(`Process payment ${paymentId} for ₹${this.formatNumber(payment.amount)}?`)) {
        payment.status = 'completed';
        payment.processedAt = new Date().toISOString();
        payment.processedBy = this.getCurrentAdmin().id;
        
        this.savePaymentsToStorage();
        this.showNotification(`Payment ${paymentId} processed successfully`, 'success');
        this.renderPaymentsTable();
        this.logAdminAction(`Processed payment: ${paymentId}`);
    }
},

cancelPayment(paymentId) {
    const payment = this.currentData.payments.find(p => p.id === paymentId);
    if (!payment) {
        this.showNotification('Payment not found', 'error');
        return;
    }

    const reason = prompt('Reason for cancellation:');
    if (!reason) return;

    if (confirm(`Cancel payment ${paymentId}?`)) {
        payment.status = 'failed';
        payment.cancelledAt = new Date().toISOString();
        payment.cancelledBy = this.getCurrentAdmin().id;
        payment.failureReason = reason;
        
        this.savePaymentsToStorage();
        this.showNotification(`Payment ${paymentId} cancelled`, 'success');
        this.renderPaymentsTable();
        this.logAdminAction(`Cancelled payment: ${paymentId}. Reason: ${reason}`);
    }
},

refundPayment(paymentId) {
    const payment = this.currentData.payments.find(p => p.id === paymentId);
    if (!payment) {
        this.showNotification('Payment not found', 'error');
        return;
    }

    if (confirm(`Issue refund for payment ${paymentId} of ₹${this.formatNumber(payment.amount)}?`)) {
        // Create refund record
        const refund = {
            id: 'REF-' + Date.now(),
            originalPaymentId: paymentId,
            userId: payment.userId,
            type: 'refund',
            amount: payment.amount,
            status: 'completed',
            paymentMethod: payment.paymentMethod,
            createdAt: new Date().toISOString(),
            refundedBy: this.getCurrentAdmin().id
        };

        // Update original payment status
        payment.status = 'refunded';
        payment.refundedAt = new Date().toISOString();
        
        // Add refund to payments
        this.currentData.payments.push(refund);
        this.savePaymentsToStorage();
        
        this.showNotification(`Refund issued for payment ${paymentId}`, 'success');
        this.renderPaymentsTable();
        this.logAdminAction(`Issued refund for payment: ${paymentId}`);
    }
},

// Enhanced viewPaymentDetails function
viewPaymentDetails(paymentId) {
    console.log('🔍 Looking for payment:', paymentId);
    console.log('All payment IDs:', this.currentData.payments.map(p => p.id));
    
    const payment = this.currentData.payments.find(p => p.id === paymentId);
    if (!payment) {
        console.error('Payment not found:', paymentId);
        this.showNotification('Payment details not found', 'error');
        return;
    }

    console.log('Found payment:', payment);
    
    const user = this.currentData.users.find(u => u.id === payment.userId);
    const worker = this.currentData.users.find(u => u.id === payment.receiverId);
    
    const details = `
=== PAYMENT DETAILS ===

💰 Payment ID: ${payment.id}
💵 Amount: ₹${this.formatNumber(payment.amount)}
📊 Status: ${payment.status}
📝 Type: ${payment.type}
💳 Payment Method: ${payment.paymentMethod}

👤 From (Employer):
${user?.fullName || payment.employerName || 'Unknown'} 
📧 ${user?.email || 'No email'}

👥 To (Worker):
${worker?.fullName || payment.workerName || 'Unknown'}
📧 ${worker?.email || 'No email'}

💼 Job: ${payment.jobTitle || 'N/A'}
📄 Agreement: ${payment.agreementId || 'N/A'}
📅 Date: ${this.formatDate(payment.createdAt)}
📋 Description: ${payment.description || 'N/A'}

${payment.hours ? `⏰ Hours: ${payment.hours}` : ''}
    `.trim();

    this.showPaymentModal(details, payment);
},
// Add modal function for better payment details display
showPaymentModal(details, payment) {
    // Remove existing modal if any
    const existingModal = document.getElementById('paymentDetailsModal');
    if (existingModal) {
        existingModal.remove();
    }

    const modal = document.createElement('div');
    modal.id = 'paymentDetailsModal';
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        padding: 20px;
    `;

    modal.innerHTML = `
        <div style="
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        ">
            <div style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 20px;
                border-bottom: 1px solid var(--border-color);
                padding-bottom: 16px;
            ">
                <h3 style="color: var(--text-primary); margin: 0;">Payment Details</h3>
                <button onclick="this.closest('#paymentDetailsModal').remove()" style="
                    background: none;
                    border: none;
                    color: var(--text-muted);
                    font-size: 1.5rem;
                    cursor: pointer;
                    padding: 0;
                ">×</button>
            </div>
            <div style="color: var(--text-primary); white-space: pre-line; line-height: 1.6;">
                ${details}
            </div>
            <div style="margin-top: 24px; display: flex; gap: 12px; justify-content: flex-end;">
                <button onclick="this.closest('#paymentDetailsModal').remove()" style="
                    background: var(--border-color);
                    color: var(--text-primary);
                    border: none;
                    padding: 10px 20px;
                    border-radius: 8px;
                    cursor: pointer;
                ">Close</button>
                ${payment.status === 'pending' ? `
                    <button onclick="AdminDashboard.processPayment('${payment.id}'); this.closest('#paymentDetailsModal').remove()" style="
                        background: var(--gold-primary);
                        color: #000;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 8px;
                        cursor: pointer;
                        font-weight: bold;
                    ">Process Payment</button>
                ` : ''}
            </div>
        </div>
    `;

    document.body.appendChild(modal);
},

// Force update statistics with DOM refresh
forceUpdateStats() {
    console.log('🔄 Forcing statistics update...');
    
    const payments = this.currentData.payments;
    console.log('Current payments for stats:', payments);
    
    // Calculate statistics
    const totalRevenue = payments
        .filter(p => p.status === 'completed')
        .reduce((sum, payment) => {
            const amount = parseFloat(payment.amount) || 0;
            console.log(`Payment ${payment.id}: ₹${amount}`);
            return sum + amount;
        }, 0);
    
    const completedPayments = payments.filter(p => p.status === 'completed').length;
    const pendingPayments = payments.filter(p => p.status === 'pending').length;
    const failedPayments = payments.filter(p => p.status === 'failed').length;

    console.log('Calculated stats:', {
        totalRevenue,
        completedPayments,
        pendingPayments,
        failedPayments
    });

    // Direct DOM manipulation to ensure update
    const totalRevenueElem = document.getElementById('totalRevenue');
    const completedPaymentsElem = document.getElementById('completedPayments');
    const pendingPaymentsElem = document.getElementById('pendingPayments');
    const failedPaymentsElem = document.getElementById('failedPayments');

    if (totalRevenueElem) {
        totalRevenueElem.textContent = `₹${this.formatNumber(totalRevenue)}`;
        totalRevenueElem.style.color = '#ffd700'; // Gold color to highlight change
        setTimeout(() => { totalRevenueElem.style.color = ''; }, 1000);
    }
    
    if (completedPaymentsElem) {
        completedPaymentsElem.textContent = completedPayments;
        completedPaymentsElem.style.color = '#10b981'; // Green color
        setTimeout(() => { completedPaymentsElem.style.color = ''; }, 1000);
    }
    
    if (pendingPaymentsElem) {
        pendingPaymentsElem.textContent = pendingPayments;
        pendingPaymentsElem.style.color = '#f59e0b'; // Orange color
        setTimeout(() => { pendingPaymentsElem.style.color = ''; }, 1000);
    }
    
    if (failedPaymentsElem) {
        failedPaymentsElem.textContent = failedPayments;
        failedPaymentsElem.style.color = '#ef4444'; // Red color
        setTimeout(() => { failedPaymentsElem.style.color = ''; }, 1000);
    }
    
    this.showNotification(`Statistics updated: ₹${this.formatNumber(totalRevenue)} total revenue`, 'success');
},
// Fixed filter functions
setupPaymentFilters() {
    console.log('Setting up payment filters...');
    
    const statusFilter = document.getElementById('paymentStatusFilter');
    const typeFilter = document.getElementById('paymentTypeFilter');
    const dateFilter = document.getElementById('paymentDateFilter');
    
    if (statusFilter) {
        statusFilter.addEventListener('change', () => this.filterPayments());
    }
    if (typeFilter) {
        typeFilter.addEventListener('change', () => this.filterPayments());
    }
    if (dateFilter) {
        dateFilter.addEventListener('change', () => this.filterPayments());
    }
    
    console.log('Payment filters setup complete');
},

// Enhanced filterPayments function
filterPayments() {
    console.log('🔍 Filtering payments...');
    
    const statusFilter = document.getElementById('paymentStatusFilter')?.value || 'all';
    const typeFilter = document.getElementById('paymentTypeFilter')?.value || 'all';
    const dateFilter = document.getElementById('paymentDateFilter')?.value || 'all';

    console.log('Filter values:', { statusFilter, typeFilter, dateFilter });

    let filteredPayments = [...this.currentData.payments];

    // Filter by status
    if (statusFilter !== 'all') {
        filteredPayments = filteredPayments.filter(p => p.status === statusFilter);
        console.log(`After status filter (${statusFilter}):`, filteredPayments.length);
    }

    // Filter by type
    if (typeFilter !== 'all') {
        filteredPayments = filteredPayments.filter(p => p.type === typeFilter);
        console.log(`After type filter (${typeFilter}):`, filteredPayments.length);
    }

    // Filter by date
    if (dateFilter !== 'all') {
        const now = new Date();
        filteredPayments = filteredPayments.filter(p => {
            const paymentDate = new Date(p.createdAt);
            switch (dateFilter) {
                case 'today':
                    return paymentDate.toDateString() === now.toDateString();
                case 'week':
                    const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    return paymentDate >= weekAgo;
                case 'month':
                    const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                    return paymentDate >= monthAgo;
                default:
                    return true;
            }
        });
        console.log(`After date filter (${dateFilter}):`, filteredPayments.length);
    }

    console.log('Final filtered payments:', filteredPayments);
    this.renderPaymentsTable(filteredPayments);
},

// Export payments data
exportPaymentsData() {
    const paymentsData = this.currentData.payments.map(payment => {
        const user = this.currentData.users.find(u => u.id === payment.userId);
        return {
            'Transaction ID': payment.id,
            'User': user ? `${user.fullName} (${user.email})` : 'Unknown',
            'Type': payment.type,
            'Amount': `₹${payment.amount}`,
            'Status': payment.status,
            'Payment Method': payment.paymentMethod || 'N/A',
            'Date': this.formatDate(payment.createdAt),
            'Job ID': payment.jobId || 'N/A'
        };
    });
    
    const csv = this.convertToCSV(paymentsData);
    this.downloadCSV(csv, 'payments_export.csv');
    this.showNotification('Payments data exported successfully', 'success');
},

// Generate payment report
generatePaymentReport() {
    const totalRevenue = this.currentData.payments
        .filter(p => p.status === 'completed')
        .reduce((sum, p) => sum + (p.amount || 0), 0);
    
    const completedCount = this.currentData.payments.filter(p => p.status === 'completed').length;
    const pendingCount = this.currentData.payments.filter(p => p.status === 'pending').length;
    
    const report = `
=== PAYMENT REPORT ===
Generated: ${new Date().toLocaleString()}
Total Revenue: ₹${this.formatNumber(totalRevenue)}
Completed Payments: ${completedCount}
Pending Payments: ${pendingCount}
Total Transactions: ${this.currentData.payments.length}
    `.trim();

    alert('Payment Report:\n\n' + report);
    this.showNotification('Payment report generated', 'success');
},
    // =============================================
    // SUSPEND/ACTIVATE FUNCTIONALITY
    // =============================================

    // User Management Functions
    suspendUser(userId) {
        const user = this.currentData.users.find(u => u.id === userId);
        if (!user) {
            this.showNotification('User not found', 'error');
            return;
        }

        const reason = prompt(`Please provide a reason for suspending ${user.fullName}:`);
        if (reason === null) return; // User cancelled

        if (!reason || reason.trim().length < 5) {
            this.showNotification('Please provide a valid reason (minimum 5 characters)', 'error');
            return;
        }

        if (confirm(`Are you sure you want to suspend ${user.fullName}?\n\nReason: ${reason}`)) {
            user.status = 'suspended';
            user.suspensionReason = reason;
            user.suspendedAt = new Date().toISOString();
            user.suspendedBy = this.getCurrentAdmin().id;
            
            this.saveUsersToStorage();
            
            this.showNotification(`User ${user.fullName} has been suspended`, 'success');
            this.renderUsersTable();
            this.logAdminAction(`Suspended user ${user.fullName} (${userId}). Reason: ${reason}`);
        }
    },

    activateUser(userId) {
        const user = this.currentData.users.find(u => u.id === userId);
        if (!user) {
            this.showNotification('User not found', 'error');
            return;
        }

        if (confirm(`Are you sure you want to activate ${user.fullName}'s account?`)) {
            user.status = 'active';
            delete user.suspensionReason;
            delete user.suspendedAt;
            delete user.suspendedBy;
            
            this.saveUsersToStorage();
            
            this.showNotification(`User ${user.fullName} has been activated`, 'success');
            this.renderUsersTable();
            this.logAdminAction(`Activated user ${user.fullName} (${userId})`);
        }
    },

    // Job Management Functions
    suspendJob(jobId) {
        const job = this.currentData.jobs.find(j => j.id === jobId);
        if (!job) {
            this.showNotification('Job not found', 'error');
            return;
        }

        const employer = this.currentData.users.find(u => u.id === job.employerId);
        const reason = prompt(`Please provide a reason for suspending job "${job.title}":`);
        if (reason === null) return;

        if (!reason || reason.trim().length < 5) {
            this.showNotification('Please provide a valid reason (minimum 5 characters)', 'error');
            return;
        }

        if (confirm(`Are you sure you want to suspend job "${job.title}"?\n\nReason: ${reason}`)) {
            const previousStatus = job.status;
            job.status = 'suspended';
            job.suspensionReason = reason;
            job.suspendedAt = new Date().toISOString();
            job.suspendedBy = this.getCurrentAdmin().id;
            job.previousStatus = previousStatus;
            
            this.saveJobsToStorage();
            
            this.showNotification(`Job "${job.title}" has been suspended`, 'success');
            this.renderJobsTable();
            this.logAdminAction(`Suspended job "${job.title}" (${jobId}). Reason: ${reason}`);
        }
    },

    activateJob(jobId) {
        const job = this.currentData.jobs.find(j => j.id === jobId);
        if (!job) {
            this.showNotification('Job not found', 'error');
            return;
        }

        if (confirm(`Are you sure you want to activate job "${job.title}"?`)) {
            job.status = job.previousStatus || 'active';
            delete job.suspensionReason;
            delete job.suspendedAt;
            delete job.suspendedBy;
            delete job.previousStatus;
            
            this.saveJobsToStorage();
            
            this.showNotification(`Job "${job.title}" has been activated`, 'success');
            this.renderJobsTable();
            this.logAdminAction(`Activated job "${job.title}" (${jobId})`);
        }
    },

    // Utility Functions for New Features
    getCurrentAdmin() {
        return JSON.parse(localStorage.getItem('currentUser') || sessionStorage.getItem('currentUser') || '{}');
    },

    createUserNotification(userId, title, message, type = 'info') {
        const notification = {
            id: 'NOT-' + Date.now(),
            userId: userId,
            title: title,
            message: message,
            type: type,
            isRead: false,
            createdAt: new Date().toISOString(),
            createdBy: 'system'
        };
        
        this.currentData.notifications.push(notification);
        this.saveNotificationsToStorage();
    },
    logAdminAction(action) {
        console.log(`🔧 Admin Action: ${action}`);
        const log = {
            action: action,
            adminId: this.getCurrentAdmin().id,
            adminName: this.getCurrentAdmin().fullName,
            timestamp: new Date().toISOString(),
            ip: '127.0.0.1'
        };
        
        const adminLogs = JSON.parse(localStorage.getItem('admin_logs') || '[]');
        adminLogs.push(log);
        localStorage.setItem('admin_logs', JSON.stringify(adminLogs));
    },

    saveNotificationsToStorage() {
        try {
            localStorage.setItem('opuslink_notifications', JSON.stringify(this.currentData.notifications));
        } catch (error) {
            console.error('Error saving notifications:', error);
        }
    },

    // Enhanced Export Functions
    exportJobsData() {
        const jobsData = this.currentData.jobs.map(job => {
            const employer = this.currentData.users.find(u => u.id === job.employerId);
            return {
                'Job ID': job.id,
                'Title': job.title,
                'Company': employer ? employer.companyName || employer.fullName : 'Unknown',
                'Category': job.category,
                'Status': job.status,
                'Salary': job.salary,
                'Applications': this.currentData.applications.filter(app => app.jobId === job.id).length,
                'Created Date': this.formatDate(job.createdAt),
                'Suspension Reason': job.suspensionReason || 'N/A',
                'Suspended At': job.suspendedAt ? this.formatDate(job.suspendedAt) : 'N/A'
            };
        });
        
        const csv = this.convertToCSV(jobsData);
        this.downloadCSV(csv, 'jobs_export.csv');
        this.showNotification('Jobs data exported successfully', 'success');
    },



    // ADD MISSING FUNCTIONS FOR ACTIONS
    viewUserDetails(userId) {
        const user = this.currentData.users.find(u => u.id === userId);
        if (user) {
            this.showNotification(`Viewing user: ${user.fullName}`, 'info');
        }
    },

    editUser(userId) {
        this.showNotification(`Edit user: ${userId}`, 'info');
    },

    approveVerification(userId) {
        if (confirm('Are you sure you want to approve this user verification?')) {
            const user = this.currentData.users.find(u => u.id === userId);
            if (user) {
                user.isVerified = true;
                this.saveUsersToStorage();
                this.showNotification(`User ${user.fullName} verification approved`, 'success');
                this.renderVerificationQueue();
                this.renderUsersTable();
            }
        }
    },

    viewJobDetails(jobId) {
        this.showNotification(`View job: ${jobId}`, 'info');
    },

    approveJob(jobId) {
        if (confirm('Are you sure you want to approve this job?')) {
            const job = this.currentData.jobs.find(j => j.id === jobId);
            if (job) {
                job.status = 'active';
                this.saveJobsToStorage();
                this.showNotification(`Job "${job.title}" approved`, 'success');
                this.renderJobsTable();
            }
        }
    },

    rejectJob(jobId) {
        if (confirm('Are you sure you want to reject this job?')) {
            const job = this.currentData.jobs.find(j => j.id === jobId);
            if (job) {
                job.status = 'rejected';
                this.saveJobsToStorage();
                this.showNotification(`Job "${job.title}" rejected`, 'success');
                this.renderJobsTable();
            }
        }
    },

    // ADD MISSING STORAGE FUNCTIONS
    saveUsersToStorage() {
        try {
            localStorage.setItem('opuslink_users', JSON.stringify(this.currentData.users));
        } catch (error) {
            console.error('Error saving users:', error);
        }
    },

    saveJobsToStorage() {
        try {
            localStorage.setItem('opuslink_jobs', JSON.stringify(this.currentData.jobs));
        } catch (error) {
            console.error('Error saving jobs:', error);
        }
    },

// Fixed renderPaymentsTable function
renderPaymentsTable(payments = this.currentData.payments) {
    console.log('🔄 Rendering payments table...');
    console.log('Payments to render:', payments);
    
    const paymentsTable = document.getElementById('paymentsTableBody');
    if (!paymentsTable) {
        console.error('❌ paymentsTableBody element not found!');
        return;
    }

    // Update payment statistics with the CURRENT payments (filtered or unfiltered)
    this.updatePaymentStatistics(payments);

    if (!payments || payments.length === 0) {
        console.log('No payments data, showing empty state');
        paymentsTable.innerHTML = `
            <tr>
                <td colspan="8" class="empty-state">
                    <div class="empty-state-icon">🔍</div>
                    <h3>No Payments Match Your Filters</h3>
                    <p>Try adjusting your filter criteria to see more results.</p>
                    <div style="margin-top: 16px;">
                        <button class="btn btn-primary" onclick="AdminDashboard.resetPaymentFilters(); AdminDashboard.filterPayments();">
                            <i class="fas fa-eye"></i> Show All Payments
                        </button>
                    </div>
                </td>
            </tr>
        `;
        return;
    }

    console.log('Rendering', payments.length, 'filtered payments');
    
    paymentsTable.innerHTML = payments.map(payment => {
        const user = this.currentData.users.find(u => u.id === payment.userId);
        const userName = payment.employerName || user?.fullName || 'Unknown User';
        const workerName = payment.workerName || 'Unknown Worker';
        
        const paymentTypeDisplay = {
            'escrow_deposit': 'Escrow Deposit',
            'payout': 'Worker Payout',
            'subscription': 'Subscription',
            'refund': 'Refund',
            'commission': 'Platform Commission'
        }[payment.type] || payment.type;

        const statusBadgeClass = {
            'completed': 'status-completed',
            'pending': 'status-pending',
            'failed': 'status-rejected',
            'refunded': 'status-cancelled'
        }[payment.status] || 'status-pending';

        const statusDisplay = {
            'completed': '✅ Completed',
            'pending': '⏳ Pending',
            'failed': '❌ Failed',
            'refunded': '↩️ Refunded'
        }[payment.status] || payment.status;

        return `
            <tr>
                <td><strong>${payment.id}</strong></td>
                <td>
                    <div class="user-info-small">
                        <div class="user-avatar-small">
                            ${(userName || 'U').charAt(0).toUpperCase()}
                        </div>
                        <div>
                            <div class="user-name">${userName}</div>
                            <div class="user-email">${user?.email || 'Employer'}</div>
                        </div>
                    </div>
                    <div style="margin-top: 8px; font-size: 0.8rem; color: var(--text-muted);">
                        <strong>To:</strong> ${workerName}
                    </div>
                </td>
                <td>
                    <span class="text-capitalize">${paymentTypeDisplay}</span>
                    ${payment.jobTitle ? `<br><small>${payment.jobTitle}</small>` : ''}
                    ${payment.agreementId ? `<br><small style="color: var(--text-muted);">Agreement: ${payment.agreementId}</small>` : ''}
                </td>
                <td><strong>₹${this.formatNumber(payment.amount || 0)}</strong></td>
                <td><span class="status-badge ${statusBadgeClass}">${statusDisplay}</span></td>
                <td>${this.formatDate(payment.createdAt)}</td>
                <td>${payment.paymentMethod || 'Escrow'}</td>
                <td>
                    <div class="admin-actions">
                        <button class="btn btn-sm btn-ghost" onclick="AdminDashboard.viewPaymentDetails('${payment.id}')">
                            <i class="fas fa-eye"></i> View
                        </button>
                        ${payment.status === 'pending' ? `
                            <button class="btn btn-sm btn-primary" onclick="AdminDashboard.processPayment('${payment.id}')">
                                <i class="fas fa-play"></i> Process
                            </button>
                        ` : ''}
                    </div>
                </td>
            </tr>
        `;
    }).join('');
    
    console.log('✅ Payments table rendered with filtered data');
},

    // ADD MISSING PAYMENT FUNCTIONS
    viewPaymentDetails(paymentId) {
        this.showNotification(`View payment: ${paymentId}`, 'info');
    },

    processPayment(paymentId) {
        if (confirm('Are you sure you want to process this payment?')) {
            const payment = this.currentData.payments.find(p => p.id === paymentId);
            if (payment) {
                payment.status = 'completed';
                this.savePaymentsToStorage();
                this.showNotification(`Payment ${paymentId} processed`, 'success');
                this.renderPaymentsTable();
            }
        }
    },

  // Update savePaymentsToStorage function
savePaymentsToStorage() {
    try {
        localStorage.setItem('opuslink_payments', JSON.stringify(this.currentData.payments));
        console.log('✅ Payments saved to localStorage:', this.currentData.payments);
    } catch (error) {
        console.error('❌ Error saving payments:', error);
        this.showNotification('Error saving payments data', 'error');
    }
},
// =============================================
// MODAL MANAGEMENT SYSTEM
// =============================================

// Modal management functions
createModal(title, content, footer = '') {
    // Remove existing modal
    this.removeModal();
    
    const modal = document.createElement('div');
    modal.className = 'modal-backdrop';
    modal.innerHTML = `
        <div class="modal-content-large">
            <div class="modal-header">
                <h3>${title}</h3>
                <button class="modal-close" onclick="AdminDashboard.removeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                ${content}
            </div>
            ${footer ? `<div class="modal-footer">${footer}</div>` : ''}
        </div>
    `;
    
    document.body.appendChild(modal);
    return modal;
},

removeModal() {
    const existingModal = document.querySelector('.modal-backdrop');
    if (existingModal) {
        existingModal.remove();
    }
},

// =============================================
// USER DETAILS MODAL
// =============================================

viewUserDetails(userId) {
    const user = this.currentData.users.find(u => u.id === userId);
    if (!user) {
        this.showNotification('User not found', 'error');
        return;
    }

    const content = `
        <div style="text-align: center; margin-bottom: 24px;">
            <div class="user-avatar-modal">
                ${(user.fullName || 'U').charAt(0).toUpperCase()}
            </div>
            <h3 style="color: var(--text-primary); margin-bottom: 8px;">${user.fullName}</h3>
            <p style="color: var(--text-secondary);">${user.email}</p>
        </div>

        <div class="detail-grid">
            <div class="detail-item">
                <span class="detail-label">User ID</span>
                <div class="detail-value">${user.id}</div>
            </div>
            <div class="detail-item">
                <span class="detail-label">Role</span>
                <div class="detail-value">
                    <span class="role-badge role-${user.role}">${user.role}</span>
                </div>
            </div>
            <div class="detail-item">
                <span class="detail-label">Status</span>
                <div class="detail-value">
                    <span class="status-indicator ${user.status === 'suspended' ? 'status-suspended' : user.isVerified ? 'status-active' : 'status-pending'}">
                        ${user.status === 'suspended' ? '⏸️ Suspended' : user.isVerified ? '✅ Active' : '⏳ Pending Verification'}
                    </span>
                </div>
            </div>
            <div class="detail-item">
                <span class="detail-label">Profile Completion</span>
                <div class="detail-value">${user.profileCompletion || 0}%</div>
            </div>
            <div class="detail-item">
                <span class="detail-label">Joined Date</span>
                <div class="detail-value">${this.formatDate(user.createdAt)}</div>
            </div>
            <div class="detail-item">
                <span class="detail-label">Last Login</span>
                <div class="detail-value">${user.lastLogin ? this.formatDate(user.lastLogin) : 'Never'}</div>
            </div>
        </div>

        ${user.companyName ? `
            <div class="detail-section">
                <div class="detail-section-title">
                    <i class="fas fa-building"></i>
                    Company Information
                </div>
                <div class="detail-grid">
                    <div class="detail-item form-full-width">
                        <span class="detail-label">Company Name</span>
                        <div class="detail-value">${user.companyName}</div>
                    </div>
                </div>
            </div>
        ` : ''}

        ${user.skills && user.skills.length > 0 ? `
            <div class="detail-section">
                <div class="detail-section-title">
                    <i class="fas fa-tools"></i>
                    Skills & Expertise
                </div>
                <div class="skills-container">
                    ${user.skills.map(skill => `<span class="skill-tag">${skill}</span>`).join('')}
                </div>
            </div>
        ` : ''}

        ${user.suspensionReason ? `
            <div class="detail-section" style="border-left: 4px solid var(--error);">
                <div class="detail-section-title" style="color: var(--error);">
                    <i class="fas fa-exclamation-triangle"></i>
                    Suspension Details
                </div>
                <div class="detail-item form-full-width">
                    <span class="detail-label">Reason</span>
                    <div class="detail-value">${user.suspensionReason}</div>
                </div>
                <div class="detail-grid">
                    <div class="detail-item">
                        <span class="detail-label">Suspended On</span>
                        <div class="detail-value">${this.formatDate(user.suspendedAt)}</div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Suspended By</span>
                        <div class="detail-value">${user.suspendedBy || 'System'}</div>
                    </div>
                </div>
            </div>
        ` : ''}
    `;

    const footer = `
        <button class="btn btn-ghost" onclick="AdminDashboard.removeModal()">
            <i class="fas fa-times"></i> Close
        </button>
        <button class="btn btn-primary" onclick="AdminDashboard.editUser('${user.id}')">
            <i class="fas fa-edit"></i> Edit User
        </button>
        ${!user.isVerified ? `
            <button class="btn btn-success" onclick="AdminDashboard.approveVerification('${user.id}'); AdminDashboard.removeModal();">
                <i class="fas fa-check"></i> Verify User
            </button>
        ` : ''}
        ${user.status !== 'suspended' ? `
            <button class="btn btn-warning" onclick="AdminDashboard.suspendUser('${user.id}'); AdminDashboard.removeModal();">
                <i class="fas fa-pause"></i> Suspend
            </button>
        ` : `
            <button class="btn btn-success" onclick="AdminDashboard.activateUser('${user.id}'); AdminDashboard.removeModal();">
                <i class="fas fa-play"></i> Activate
            </button>
        `}
    `;

    this.createModal('User Details', content, footer);
},

editUser(userId) {
    const user = this.currentData.users.find(u => u.id === userId);
    if (!user) {
        this.showNotification('User not found', 'error');
        return;
    }

    const content = `
        <div class="edit-form">
            <div class="detail-item form-full-width">
                <span class="detail-label">User ID</span>
                <div class="detail-value">${user.id}</div>
            </div>
            
            <div class="detail-item">
                <span class="detail-label">Full Name *</span>
                <input type="text" class="form-control" id="editUserName" value="${user.fullName || ''}" placeholder="Enter full name">
            </div>
            
            <div class="detail-item">
                <span class="detail-label">Email *</span>
                <input type="email" class="form-control" id="editUserEmail" value="${user.email || ''}" placeholder="Enter email">
            </div>
            
            <div class="detail-item">
                <span class="detail-label">Role</span>
                <select class="form-control" id="editUserRole">
                    <option value="worker" ${user.role === 'worker' ? 'selected' : ''}>Worker</option>
                    <option value="employer" ${user.role === 'employer' ? 'selected' : ''}>Employer</option>
                    <option value="admin" ${user.role === 'admin' ? 'selected' : ''}>Admin</option>
                </select>
            </div>
            
            <div class="detail-item">
                <span class="detail-label">Status</span>
                <select class="form-control" id="editUserStatus">
                    <option value="active" ${user.status === 'active' ? 'selected' : ''}>Active</option>
                    <option value="suspended" ${user.status === 'suspended' ? 'selected' : ''}>Suspended</option>
                    <option value="pending" ${!user.status || user.status === 'pending' ? 'selected' : ''}>Pending</option>
                </select>
            </div>
            
            <div class="detail-item">
                <span class="detail-label">Verification Status</span>
                <select class="form-control" id="editUserVerification">
                    <option value="true" ${user.isVerified ? 'selected' : ''}>Verified</option>
                    <option value="false" ${!user.isVerified ? 'selected' : ''}>Not Verified</option>
                </select>
            </div>
            
            <div class="detail-item">
                <span class="detail-label">Profile Completion</span>
                <input type="number" class="form-control" id="editUserProfileCompletion" 
                       value="${user.profileCompletion || 0}" min="0" max="100" placeholder="0-100">
            </div>

            ${user.companyName ? `
                <div class="detail-item">
                    <span class="detail-label">Company Name</span>
                    <input type="text" class="form-control" id="editUserCompany" 
                           value="${user.companyName}" placeholder="Company name">
                </div>
            ` : ''}

            <div class="detail-item form-full-width">
                <span class="detail-label">Skills (comma separated)</span>
                <input type="text" class="form-control" id="editUserSkills" 
                       value="${user.skills ? user.skills.join(', ') : ''}" placeholder="Skill1, Skill2, Skill3">
            </div>
        </div>
    `;

    const footer = `
        <button class="btn btn-ghost" onclick="AdminDashboard.removeModal()">
            <i class="fas fa-times"></i> Cancel
        </button>
        <button class="btn btn-primary" onclick="AdminDashboard.saveUserChanges('${user.id}')">
            <i class="fas fa-save"></i> Save Changes
        </button>
    `;

    this.createModal('Edit User', content, footer);
},

saveUserChanges(userId) {
    const user = this.currentData.users.find(u => u.id === userId);
    if (!user) {
        this.showNotification('User not found', 'error');
        return;
    }

    // Get form values
    const fullName = document.getElementById('editUserName').value;
    const email = document.getElementById('editUserEmail').value;
    const role = document.getElementById('editUserRole').value;
    const status = document.getElementById('editUserStatus').value;
    const isVerified = document.getElementById('editUserVerification').value === 'true';
    const profileCompletion = parseInt(document.getElementById('editUserProfileCompletion').value) || 0;
    const companyName = document.getElementById('editUserCompany') ? document.getElementById('editUserCompany').value : '';
    const skills = document.getElementById('editUserSkills').value.split(',').map(s => s.trim()).filter(s => s);

    // Validation
    if (!fullName || !email) {
        this.showNotification('Name and email are required', 'error');
        return;
    }

    // Update user
    user.fullName = fullName;
    user.email = email;
    user.role = role;
    user.status = status;
    user.isVerified = isVerified;
    user.profileCompletion = profileCompletion;
    
    if (companyName) user.companyName = companyName;
    if (skills.length > 0) user.skills = skills;

    user.updatedAt = new Date().toISOString();
    user.updatedBy = this.getCurrentAdmin().id;

    // Save to storage
    this.saveUsersToStorage();
    
    this.showNotification('User updated successfully', 'success');
    this.removeModal();
    this.renderUsersTable();
    this.logAdminAction(`Updated user: ${user.fullName} (${user.id})`);
},

// =============================================
// JOB DETAILS MODAL
// =============================================

viewJobDetails(jobId) {
    const job = this.currentData.jobs.find(j => j.id === jobId);
    if (!job) {
        this.showNotification('Job not found', 'error');
        return;
    }

    const employer = this.currentData.users.find(u => u.id === job.employerId);
    const applications = this.currentData.applications.filter(app => app.jobId === jobId);
    const applicationCount = applications.length;

    const content = `
        <div style="text-align: center; margin-bottom: 24px;">
            <div style="font-size: 3rem; margin-bottom: 16px;">💼</div>
            <h3 style="color: var(--text-primary); margin-bottom: 8px;">${job.title}</h3>
            <p style="color: var(--text-secondary);">${employer ? employer.companyName || employer.fullName : 'Unknown Company'}</p>
        </div>

        <div class="detail-grid">
            <div class="detail-item">
                <span class="detail-label">Job ID</span>
                <div class="detail-value">${job.id}</div>
            </div>
            <div class="detail-item">
                <span class="detail-label">Status</span>
                <div class="detail-value">
                    <span class="status-indicator ${job.status === 'suspended' ? 'status-suspended' : job.status === 'active' ? 'status-active' : 'status-pending'}">
                        ${job.status === 'suspended' ? '⏸️ Suspended' : job.status === 'active' ? '✅ Active' : '⏳ Pending'}
                    </span>
                </div>
            </div>
            <div class="detail-item">
                <span class="detail-label">Category</span>
                <div class="detail-value">${job.category || 'Not specified'}</div>
            </div>
            <div class="detail-item">
                <span class="detail-label">Salary</span>
                <div class="detail-value">${job.salary || 'Not specified'}</div>
            </div>
            <div class="detail-item">
                <span class="detail-label">Applications</span>
                <div class="detail-value">${applicationCount}</div>
            </div>
            <div class="detail-item">
                <span class="detail-label">Posted Date</span>
                <div class="detail-value">${this.formatDate(job.createdAt)}</div>
            </div>
        </div>

        <div class="detail-section">
            <div class="detail-section-title">
                <i class="fas fa-building"></i>
                Employer Information
            </div>
            <div class="detail-grid">
                <div class="detail-item">
                    <span class="detail-label">Company</span>
                    <div class="detail-value">${employer ? employer.companyName || 'Individual' : 'Unknown'}</div>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Contact</span>
                    <div class="detail-value">${employer ? employer.email : 'Unknown'}</div>
                </div>
            </div>
        </div>

        ${job.description ? `
            <div class="detail-section">
                <div class="detail-section-title">
                    <i class="fas fa-file-alt"></i>
                    Job Description
                </div>
                <div class="detail-value" style="min-height: auto; white-space: pre-wrap;">${job.description}</div>
            </div>
        ` : ''}

        ${job.requirements ? `
            <div class="detail-section">
                <div class="detail-section-title">
                    <i class="fas fa-list-check"></i>
                    Requirements
                </div>
                <div class="detail-value" style="min-height: auto; white-space: pre-wrap;">${job.requirements}</div>
            </div>
        ` : ''}

        ${job.suspensionReason ? `
            <div class="detail-section" style="border-left: 4px solid var(--error);">
                <div class="detail-section-title" style="color: var(--error);">
                    <i class="fas fa-exclamation-triangle"></i>
                    Suspension Details
                </div>
                <div class="detail-item form-full-width">
                    <span class="detail-label">Reason</span>
                    <div class="detail-value">${job.suspensionReason}</div>
                </div>
                <div class="detail-grid">
                    <div class="detail-item">
                        <span class="detail-label">Suspended On</span>
                        <div class="detail-value">${this.formatDate(job.suspendedAt)}</div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Suspended By</span>
                        <div class="detail-value">${job.suspendedBy || 'System'}</div>
                    </div>
                </div>
            </div>
        ` : ''}
    `;

    const footer = `
        <button class="btn btn-ghost" onclick="AdminDashboard.removeModal()">
            <i class="fas fa-times"></i> Close
        </button>
        <button class="btn btn-primary" onclick="AdminDashboard.editJob('${job.id}')">
            <i class="fas fa-edit"></i> Edit Job
        </button>
        ${job.status === 'pending' ? `
            <button class="btn btn-success" onclick="AdminDashboard.approveJob('${job.id}'); AdminDashboard.removeModal();">
                <i class="fas fa-check"></i> Approve
            </button>
            <button class="btn btn-danger" onclick="AdminDashboard.rejectJob('${job.id}'); AdminDashboard.removeModal();">
                <i class="fas fa-times"></i> Reject
            </button>
        ` : ''}
        ${job.status !== 'suspended' && job.status !== 'pending' ? `
            <button class="btn btn-warning" onclick="AdminDashboard.suspendJob('${job.id}'); AdminDashboard.removeModal();">
                <i class="fas fa-pause"></i> Suspend
            </button>
        ` : ''}
        ${job.status === 'suspended' ? `
            <button class="btn btn-success" onclick="AdminDashboard.activateJob('${job.id}'); AdminDashboard.removeModal();">
                <i class="fas fa-play"></i> Activate
            </button>
        ` : ''}
    `;

    this.createModal('Job Details', content, footer);
},

editJob(jobId) {
    const job = this.currentData.jobs.find(j => j.id === jobId);
    if (!job) {
        this.showNotification('Job not found', 'error');
        return;
    }

    const content = `
        <div class="edit-form">
            <div class="detail-item form-full-width">
                <span class="detail-label">Job ID</span>
                <div class="detail-value">${job.id}</div>
            </div>
            
            <div class="detail-item form-full-width">
                <span class="detail-label">Job Title *</span>
                <input type="text" class="form-control" id="editJobTitle" value="${job.title || ''}" placeholder="Enter job title">
            </div>
            
            <div class="detail-item">
                <span class="detail-label">Category</span>
                <input type="text" class="form-control" id="editJobCategory" value="${job.category || ''}" placeholder="e.g., Tech, Design">
            </div>
            
            <div class="detail-item">
                <span class="detail-label">Salary</span>
                <input type="text" class="form-control" id="editJobSalary" value="${job.salary || ''}" placeholder="e.g., ₹50,000 - ₹80,000">
            </div>
            
            <div class="detail-item">
                <span class="detail-label">Status</span>
                <select class="form-control" id="editJobStatus">
                    <option value="active" ${job.status === 'active' ? 'selected' : ''}>Active</option>
                    <option value="pending" ${job.status === 'pending' ? 'selected' : ''}>Pending</option>
                    <option value="suspended" ${job.status === 'suspended' ? 'selected' : ''}>Suspended</option>
                    <option value="completed" ${job.status === 'completed' ? 'selected' : ''}>Completed</option>
                    <option value="cancelled" ${job.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                </select>
            </div>

            <div class="detail-item form-full-width">
                <span class="detail-label">Job Description</span>
                <textarea class="form-control" id="editJobDescription" rows="4" placeholder="Enter job description">${job.description || ''}</textarea>
            </div>

            <div class="detail-item form-full-width">
                <span class="detail-label">Requirements</span>
                <textarea class="form-control" id="editJobRequirements" rows="3" placeholder="Enter job requirements">${job.requirements || ''}</textarea>
            </div>
        </div>
    `;

    const footer = `
        <button class="btn btn-ghost" onclick="AdminDashboard.removeModal()">
            <i class="fas fa-times"></i> Cancel
        </button>
        <button class="btn btn-primary" onclick="AdminDashboard.saveJobChanges('${job.id}')">
            <i class="fas fa-save"></i> Save Changes
        </button>
    `;

    this.createModal('Edit Job', content, footer);
},

saveJobChanges(jobId) {
    const job = this.currentData.jobs.find(j => j.id === jobId);
    if (!job) {
        this.showNotification('Job not found', 'error');
        return;
    }

    // Get form values
    const title = document.getElementById('editJobTitle').value;
    const category = document.getElementById('editJobCategory').value;
    const salary = document.getElementById('editJobSalary').value;
    const status = document.getElementById('editJobStatus').value;
    const description = document.getElementById('editJobDescription').value;
    const requirements = document.getElementById('editJobRequirements').value;

    // Validation
    if (!title) {
        this.showNotification('Job title is required', 'error');
        return;
    }

    // Update job
    job.title = title;
    job.category = category;
    job.salary = salary;
    job.status = status;
    job.description = description;
    job.requirements = requirements;
    job.updatedAt = new Date().toISOString();
    job.updatedBy = this.getCurrentAdmin().id;

    // Save to storage
    this.saveJobsToStorage();
    
    this.showNotification('Job updated successfully', 'success');
    this.removeModal();
    this.renderJobsTable();
    this.logAdminAction(`Updated job: ${job.title} (${job.id})`);
},

// =============================================
// PAYMENT DETAILS MODAL (Enhanced)
// =============================================

viewPaymentDetails(paymentId) {
    const payment = this.currentData.payments.find(p => p.id === paymentId);
    if (!payment) {
        this.showNotification('Payment not found', 'error');
        return;
    }

    const user = this.currentData.users.find(u => u.id === payment.userId);
    const worker = this.currentData.users.find(u => u.id === payment.receiverId);
    const job = this.currentData.jobs.find(j => j.id === payment.jobId);

    const content = `
        <div style="text-align: center; margin-bottom: 24px;">
            <div style="font-size: 3rem; margin-bottom: 16px;">💰</div>
            <h3 style="color: var(--text-primary); margin-bottom: 8px;">Payment Details</h3>
            <p style="color: var(--text-secondary);">Transaction ID: ${payment.id}</p>
        </div>

        <div class="detail-grid">
            <div class="detail-item">
                <span class="detail-label">Amount</span>
                <div class="detail-value" style="font-size: 1.2rem; font-weight: bold; color: var(--gold-primary);">
                    ₹${this.formatNumber(payment.amount || 0)}
                </div>
            </div>
            <div class="detail-item">
                <span class="detail-label">Status</span>
                <div class="detail-value">
                    <span class="status-indicator ${payment.status === 'completed' ? 'status-active' : payment.status === 'pending' ? 'status-pending' : 'status-suspended'}">
                        ${payment.status === 'completed' ? '✅ Completed' : payment.status === 'pending' ? '⏳ Pending' : '❌ Failed'}
                    </span>
                </div>
            </div>
            <div class="detail-item">
                <span class="detail-label">Type</span>
                <div class="detail-value">${payment.type || 'N/A'}</div>
            </div>
            <div class="detail-item">
                <span class="detail-label">Payment Method</span>
                <div class="detail-value">${payment.paymentMethod || 'Escrow'}</div>
            </div>
            <div class="detail-item">
                <span class="detail-label">Date</span>
                <div class="detail-value">${this.formatDate(payment.createdAt)}</div>
            </div>
            <div class="detail-item">
                <span class="detail-label">Currency</span>
                <div class="detail-value">${payment.currency || 'INR'}</div>
            </div>
        </div>

        <div class="detail-section">
            <div class="detail-section-title">
                <i class="fas fa-user"></i>
                Payer Information
            </div>
            <div class="detail-grid">
                <div class="detail-item">
                    <span class="detail-label">Name</span>
                    <div class="detail-value">${user ? user.fullName : payment.employerName || 'Unknown'}</div>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Email</span>
                    <div class="detail-value">${user ? user.email : 'N/A'}</div>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Role</span>
                    <div class="detail-value">${user ? user.role : 'Employer'}</div>
                </div>
            </div>
        </div>

        <div class="detail-section">
            <div class="detail-section-title">
                <i class="fas fa-user-check"></i>
                Recipient Information
            </div>
            <div class="detail-grid">
                <div class="detail-item">
                    <span class="detail-label">Name</span>
                    <div class="detail-value">${worker ? worker.fullName : payment.workerName || 'Unknown'}</div>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Email</span>
                    <div class="detail-value">${worker ? worker.email : 'N/A'}</div>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Role</span>
                    <div class="detail-value">Worker</div>
                </div>
            </div>
        </div>

        ${job || payment.jobTitle ? `
            <div class="detail-section">
                <div class="detail-section-title">
                    <i class="fas fa-briefcase"></i>
                    Job Information
                </div>
                <div class="detail-grid">
                    <div class="detail-item">
                        <span class="detail-label">Job Title</span>
                        <div class="detail-value">${payment.jobTitle || job?.title || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Job ID</span>
                        <div class="detail-value">${payment.jobId || job?.id || 'N/A'}</div>
                    </div>
                    ${payment.agreementId ? `
                        <div class="detail-item">
                            <span class="detail-label">Agreement ID</span>
                            <div class="detail-value">${payment.agreementId}</div>
                        </div>
                    ` : ''}
                </div>
            </div>
        ` : ''}

        ${payment.description ? `
            <div class="detail-section">
                <div class="detail-section-title">
                    <i class="fas fa-file-alt"></i>
                    Description
                </div>
                <div class="detail-value" style="min-height: auto; white-space: pre-wrap;">${payment.description}</div>
            </div>
        ` : ''}

        ${payment.hours ? `
            <div class="detail-section">
                <div class="detail-section-title">
                    <i class="fas fa-clock"></i>
                    Work Details
                </div>
                <div class="detail-grid">
                    <div class="detail-item">
                        <span class="detail-label">Hours Worked</span>
                        <div class="detail-value">${payment.hours} hours</div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Hourly Rate</span>
                        <div class="detail-value">₹${this.formatNumber(payment.amount / payment.hours)}/hour</div>
                    </div>
                </div>
            </div>
        ` : ''}
    `;

    const footer = `
        <button class="btn btn-ghost" onclick="AdminDashboard.removeModal()">
            <i class="fas fa-times"></i> Close
        </button>
        ${payment.status === 'pending' ? `
            <button class="btn btn-primary" onclick="AdminDashboard.processPayment('${payment.id}'); AdminDashboard.removeModal();">
                <i class="fas fa-play"></i> Process Payment
            </button>
        ` : ''}
        ${payment.status === 'completed' ? `
            <button class="btn btn-warning" onclick="AdminDashboard.refundPayment('${payment.id}'); AdminDashboard.removeModal();">
                <i class="fas fa-undo"></i> Refund
            </button>
        ` : ''}
    `;

    this.createModal('Payment Details', content, footer);
},

// =============================================
// ADMIN USER DETAILS MODAL
// =============================================

viewAdmin(adminId) {
    const admin = this.currentData.users.find(u => u.id === adminId);
    if (!admin) {
        this.showNotification('Admin not found', 'error');
        return;
    }

    const roleDisplay = {
        'super_admin': 'Super Administrator',
        'admin': 'Administrator',
        'moderator': 'Moderator',
        'support': 'Support Admin'
    }[admin.role] || admin.role;

    const content = `
        <div style="text-align: center; margin-bottom: 24px;">
            <div class="user-avatar-modal" style="background: linear-gradient(135deg, #ffd700, #b8860b);">
                ${(admin.fullName || 'A').charAt(0).toUpperCase()}
            </div>
            <h3 style="color: var(--text-primary); margin-bottom: 8px;">${admin.fullName}</h3>
            <p style="color: var(--text-secondary);">${admin.email}</p>
            <div style="margin-top: 8px;">
                <span class="role-badge role-admin" style="font-size: 1rem; padding: 8px 16px;">${roleDisplay}</span>
            </div>
        </div>

        <div class="detail-grid">
            <div class="detail-item">
                <span class="detail-label">Admin ID</span>
                <div class="detail-value">${admin.id}</div>
            </div>
            <div class="detail-item">
                <span class="detail-label">Status</span>
                <div class="detail-value">
                    <span class="status-indicator status-active">
                        ✅ Active
                    </span>
                </div>
            </div>
            <div class="detail-item">
                <span class="detail-label">Profile Completion</span>
                <div class="detail-value">${admin.profileCompletion || 100}%</div>
            </div>
            <div class="detail-item">
                <span class="detail-label">Joined Date</span>
                <div class="detail-value">${this.formatDate(admin.createdAt)}</div>
            </div>
            <div class="detail-item">
                <span class="detail-label">Last Login</span>
                <div class="detail-value">${admin.lastLogin ? this.formatDate(admin.lastLogin) : 'Never'}</div>
            </div>
            <div class="detail-item">
                <span class="detail-label">Last Updated</span>
                <div class="detail-value">${admin.updatedAt ? this.formatDate(admin.updatedAt) : 'Never'}</div>
            </div>
        </div>

        ${admin.permissions && admin.permissions.length > 0 ? `
            <div class="detail-section">
                <div class="detail-section-title">
                    <i class="fas fa-shield-alt"></i>
                    Permissions
                </div>
                <div class="skills-container">
                    ${admin.permissions.map(perm => `
                        <span class="skill-tag" style="background: var(--gold-primary); color: #000; border: none;">
                            <i class="fas fa-check"></i> ${perm.replace(/_/g, ' ').toUpperCase()}
                        </span>
                    `).join('')}
                </div>
            </div>
        ` : ''}
    `;

    const footer = `
        <button class="btn btn-ghost" onclick="AdminDashboard.removeModal()">
            <i class="fas fa-times"></i> Close
        </button>
        ${admin.role !== 'super_admin' ? `
            <button class="btn btn-primary" onclick="AdminDashboard.editAdmin('${admin.id}')">
                <i class="fas fa-edit"></i> Edit Admin
            </button>
        ` : ''}
    `;

    this.createModal('Admin Details', content, footer);
},

editAdmin(adminId) {
    const admin = this.currentData.users.find(u => u.id === adminId);
    if (!admin) {
        this.showNotification('Admin not found', 'error');
        return;
    }

    const content = `
        <div class="edit-form">
            <div class="detail-item form-full-width">
                <span class="detail-label">Admin ID</span>
                <div class="detail-value">${admin.id}</div>
            </div>
            
            <div class="detail-item">
                <span class="detail-label">Full Name *</span>
                <input type="text" class="form-control" id="editAdminName" value="${admin.fullName || ''}" placeholder="Enter full name">
            </div>
            
            <div class="detail-item">
                <span class="detail-label">Email *</span>
                <input type="email" class="form-control" id="editAdminEmail" value="${admin.email || ''}" placeholder="Enter email">
            </div>
            
            <div class="detail-item">
                <span class="detail-label">Role</span>
                <select class="form-control" id="editAdminRole">
                    <option value="super_admin" ${admin.role === 'super_admin' ? 'selected' : ''}>Super Administrator</option>
                    <option value="admin" ${admin.role === 'admin' ? 'selected' : ''}>Administrator</option>
                    <option value="moderator" ${admin.role === 'moderator' ? 'selected' : ''}>Moderator</option>
                    <option value="support" ${admin.role === 'support' ? 'selected' : ''}>Support Admin</option>
                </select>
            </div>

            <div class="detail-item form-full-width">
                <span class="detail-label">Permissions</span>
                <div class="permissions-grid">
                    <label class="checkbox-label">
                        <input type="checkbox" name="adminPermissions" value="user_management" ${admin.permissions && admin.permissions.includes('user_management') ? 'checked' : ''}> User Management
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="adminPermissions" value="content_moderation" ${admin.permissions && admin.permissions.includes('content_moderation') ? 'checked' : ''}> Content Moderation
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="adminPermissions" value="payment_management" ${admin.permissions && admin.permissions.includes('payment_management') ? 'checked' : ''}> Payment Management
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="adminPermissions" value="system_settings" ${admin.permissions && admin.permissions.includes('system_settings') ? 'checked' : ''}> System Settings
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="adminPermissions" value="reports" ${admin.permissions && admin.permissions.includes('reports') ? 'checked' : ''}> Reports & Analytics
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="adminPermissions" value="admin_management" ${admin.permissions && admin.permissions.includes('admin_management') ? 'checked' : ''}> Admin Management
                    </label>
                </div>
            </div>
        </div>
    `;

    const footer = `
        <button class="btn btn-ghost" onclick="AdminDashboard.removeModal()">
            <i class="fas fa-times"></i> Cancel
        </button>
        <button class="btn btn-primary" onclick="AdminDashboard.saveAdminChanges('${admin.id}')">
            <i class="fas fa-save"></i> Save Changes
        </button>
    `;

    this.createModal('Edit Admin', content, footer);
},

saveAdminChanges(adminId) {
    const admin = this.currentData.users.find(u => u.id === adminId);
    if (!admin) {
        this.showNotification('Admin not found', 'error');
        return;
    }

    // Get form values
    const fullName = document.getElementById('editAdminName').value;
    const email = document.getElementById('editAdminEmail').value;
    const role = document.getElementById('editAdminRole').value;

    // Get permissions
    const permissions = [];
    const checkboxes = document.querySelectorAll('input[name="adminPermissions"]:checked');
    checkboxes.forEach(checkbox => {
        permissions.push(checkbox.value);
    });

    // Validation
    if (!fullName || !email) {
        this.showNotification('Name and email are required', 'error');
        return;
    }

    // Update admin
    admin.fullName = fullName;
    admin.email = email;
    admin.role = role;
    admin.permissions = permissions;
    admin.updatedAt = new Date().toISOString();
    admin.updatedBy = this.getCurrentAdmin().id;

    // Save to storage
    this.saveUsersToStorage();
    
    this.showNotification('Admin updated successfully', 'success');
    this.removeModal();
    this.renderAdminUsers();
    this.logAdminAction(`Updated admin: ${admin.fullName} (${admin.id})`);
},


    // New Applications Table
    renderApplicationsTable() {
        // This can be added to a new applications section
        console.log('Applications data:', this.currentData.applications);
    },

    // Enhanced Verification Queue with Real Data
    renderVerificationQueue() {
        const pendingVerifications = this.currentData.users.filter(user => 
            !user.isVerified && user.role !== 'admin'
        );
        
        const container = document.getElementById('verification-queue');
        const pendingCount = document.getElementById('pendingVerifications');
        const verifiedCount = document.getElementById('verifiedUsers');
        const totalCount = document.getElementById('totalUsers');
        const rejectedCount = document.getElementById('rejectedUsers');
        
        if (pendingCount) pendingCount.textContent = pendingVerifications.length;
        if (verifiedCount) verifiedCount.textContent = this.currentData.users.filter(user => user.isVerified).length;
        if (totalCount) totalCount.textContent = this.currentData.users.length;
        if (rejectedCount) rejectedCount.textContent = 0; // You might want to track rejections

        if (!container) return;

        if (pendingVerifications.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">✅</div>
                    <h3>No Pending Verifications</h3>
                    <p>All users are currently verified.</p>
                </div>
            `;
            return;
        }

        container.innerHTML = pendingVerifications.map(user => `
            <div class="verification-item">
                <div class="verification-item-content">
                    <div class="user-avatar-large">
                        ${(user.fullName || 'U').charAt(0).toUpperCase()}
                    </div>
                    <div class="verification-details">
                        <h4>${user.fullName}</h4>
                        <div class="user-meta">
                            <span>${user.email}</span>
                            <span class="role-badge role-${user.role}">${user.role}</span>
                            <span>Joined: ${this.formatDate(user.createdAt)}</span>
                        </div>
                        <div class="verification-stats">
                            <span class="stat-tag profile-completion">
                                📊 Profile: ${user.profileCompletion || 0}% Complete
                            </span>
                            ${user.companyName ? `
                                <span class="stat-tag company">
                                    🏢 ${user.companyName}
                                </span>
                            ` : ''}
                            ${user.skills && user.skills.length > 0 ? `
                                <span class="stat-tag skills">
                                    💼 ${user.skills.slice(0, 3).join(', ')}
                                </span>
                            ` : ''}
                        </div>
                    </div>
                </div>
                <div class="verification-actions">
                    <button class="btn btn-success btn-sm" onclick="AdminDashboard.approveVerification('${user.id}')">
                        <i class="fas fa-check"></i> Approve
                    </button>
                    <button class="btn btn-warning btn-sm" onclick="AdminDashboard.requestMoreInfo('${user.id}')">
                        <i class="fas fa-info-circle"></i> Request Info
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="AdminDashboard.rejectVerification('${user.id}')">
                        <i class="fas fa-times"></i> Reject
                    </button>
                    <button class="btn btn-ghost btn-sm" onclick="AdminDashboard.viewUserDetails('${user.id}')">
                        <i class="fas fa-eye"></i> Details
                    </button>
                </div>
            </div>
        `).join('');
    },

    // ADD MISSING REJECT VERIFICATION FUNCTION
    rejectVerification(userId) {
        const reason = prompt('Please provide a reason for rejection:');
        if (reason) {
            const user = this.currentData.users.find(u => u.id === userId);
            if (user) {
                user.verificationStatus = 'rejected';
                user.rejectionReason = reason;
                this.saveUsersToStorage();
                this.showNotification(`User ${user.fullName} verification rejected. Reason: ${reason}`, 'success');
                this.renderVerificationQueue();
            }
        }
    },

    // ADD MISSING REQUEST MORE INFO FUNCTION
    requestMoreInfo(userId) {
        const infoRequest = prompt('What additional information do you need from the user?');
        if (infoRequest) {
            this.showNotification(`Information request sent to user ${userId}`, 'success');
        }
    },

    // Enhanced Recent Activity with Real Data
    renderRecentActivity() {
        const activities = this.getRecentActivities();
        const activityList = document.querySelector('.activity-list');
        
        if (!activityList) return;

        if (activities.length === 0) {
            activityList.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">📊</div>
                    <h3>No Recent Activity</h3>
                    <p>Activity will appear here as users interact with the platform</p>
                </div>
            `;
            return;
        }

        activityList.innerHTML = activities.map(activity => `
            <div class="activity-item">
                <div class="activity-icon ${activity.type}">
                    <i class="${activity.icon}"></i>
                </div>
                <div class="activity-content">
                    <div class="activity-title">${activity.title}</div>
                    <div class="activity-desc">${activity.description}</div>
                    <div class="activity-time">${activity.time}</div>
                </div>
            </div>
        `).join('');
    },

    getRecentActivities() {
        const activities = [];
        const now = new Date();
        
        // Recent user registrations
        const recentUsers = this.currentData.users
            .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
            .slice(0, 2);
        
        recentUsers.forEach(user => {
            activities.push({
                type: 'user',
                icon: 'fas fa-user-plus',
                title: 'New user registered',
                description: `${user.fullName} joined as ${user.role}`,
                time: this.formatTimeAgo(new Date(user.createdAt))
            });
        });

        // Recent job postings
        const recentJobs = this.currentData.jobs
            .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
            .slice(0, 2);
        
        recentJobs.forEach(job => {
            activities.push({
                type: 'job',
                icon: 'fas fa-briefcase',
                title: 'New job posted',
                description: `${job.title} by ${job.companyName}`,
                time: this.formatTimeAgo(new Date(job.createdAt))
            });
        });

        // Recent applications
        const recentApplications = this.currentData.applications
            .sort((a, b) => new Date(b.appliedAt) - new Date(a.appliedAt))
            .slice(0, 1);
        
        recentApplications.forEach(app => {
            const job = this.currentData.jobs.find(j => j.id === app.jobId);
            const worker = this.currentData.users.find(u => u.id === app.workerId);
            if (job && worker) {
                activities.push({
                    type: 'application',
                    icon: 'fas fa-file-alt',
                    title: 'New job application',
                    description: `${worker.fullName} applied for ${job.title}`,
                    time: this.formatTimeAgo(new Date(app.appliedAt))
                });
            }
        });

        return activities.sort((a, b) => new Date(b.time) - new Date(a.time)).slice(0, 4);
    },

    // ADD MISSING SYSTEM HEALTH RENDER
    renderSystemHealth() {
        // System health is hardcoded in HTML for this demo
    },

    // ADD MISSING REPORTS RENDER
    renderReports() {
        console.log('Rendering reports section...');
    },

    // ADD MISSING NOTIFICATIONS TABLE RENDER
    renderNotificationsTable() {
        // Notifications table is hardcoded in HTML for this demo
    },

    // ADD MISSING ADMIN USERS RENDER
    renderAdminUsers() {
        // Admin users table is hardcoded in HTML for this demo
    },

    // ADD MISSING MODERATION TABLE RENDER
    renderModerationTable() {
        // Moderation table is hardcoded in HTML for this demo
    },

    // ADD MISSING SYSTEM SETTINGS LOAD
    loadSystemSettings() {
        console.log('Loading system settings...');
    },

    // ADD MISSING CREATE NEW ADMIN
    createNewAdmin() {
        this.showNotification('Admin account creation functionality would be implemented here', 'info');
    },

    // ADD MISSING SAVE SYSTEM SETTINGS
    saveSystemSettings() {
        this.showNotification('System settings saved successfully', 'success');
    },

    // ADD MISSING SEARCH FUNCTIONS
    searchAllData(searchTerm) {
        console.log('Searching for:', searchTerm);
        this.showNotification(`Searching for: ${searchTerm}`, 'info');
    },

    resetSearch() {
        const activeSection = document.querySelector('.dashboard-section.active');
        if (activeSection) {
            this.loadSectionData(activeSection.id);
        }
    },

    // Update navigation badges with real counts
    updateNavigationBadges() {
        const pendingVerifications = this.currentData.users.filter(user => 
            !user.isVerified && user.role !== 'admin'
        ).length;
        
        const pendingJobs = this.currentData.jobs.filter(job => job.status === 'pending').length;
        const pendingModeration = pendingJobs; // You can add other moderation items
        
        // Update badges
        this.updateBadge('[data-section="verification"]', pendingVerifications);
        this.updateBadge('[data-section="jobs"]', pendingJobs);
        this.updateBadge('[data-section="moderation"]', pendingModeration);
    },

    updateBadge(selector, count) {
        const element = document.querySelector(selector);
        if (!element) return;
        
        let badge = element.querySelector('.nav-badge');
        if (count === 0) {
            if (badge) badge.remove();
            return;
        }

        if (!badge) {
            badge = document.createElement('span');
            badge.className = 'nav-badge';
            element.appendChild(badge);
        }
        badge.textContent = count > 99 ? '99+' : count;
    },

    // ADD MISSING NOTIFICATION FUNCTION
    showNotification(message, type = 'info') {
        // Create a simple notification
        const notification = document.createElement('div');
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${type === 'error' ? '#ef4444' : type === 'success' ? '#10b981' : type === 'warning' ? '#f59e0b' : '#3b82f6'};
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            gap: 8px;
        `;
        
        let icon = 'info-circle';
        if (type === 'success') icon = 'check-circle';
        if (type === 'error') icon = 'exclamation-circle';
        if (type === 'warning') icon = 'exclamation-triangle';
        
        notification.innerHTML = `
            <i class="fas fa-${icon}"></i>
            <span>${message}</span>
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 5000);
    },

    // Utility functions
    formatNumber(num) {
        return new Intl.NumberFormat().format(num);
    },

    formatDate(dateString) {
        if (!dateString) return 'Unknown';
        return new Date(dateString).toLocaleDateString();
    },

    formatTimeAgo(date) {
        const now = new Date();
        const diffMs = now - date;
        const diffMins = Math.floor(diffMs / 60000);
        const diffHours = Math.floor(diffMs / 3600000);
        const diffDays = Math.floor(diffMs / 86400000);

        if (diffMins < 1) return 'Just now';
        if (diffMins < 60) return `${diffMins}m ago`;
        if (diffHours < 24) return `${diffHours}h ago`;
        if (diffDays < 7) return `${diffDays}d ago`;
        return date.toLocaleDateString();
    },

    // Add this CSS for the stat icons
    addCustomStyles() {
        const style = document.createElement('style');
        style.textContent = `
            .stat-icon {
                position: absolute;
                top: 20px;
                right: 20px;
                font-size: 2rem;
                opacity: 0.7;
            }
            .text-capitalize {
                text-transform: capitalize;
            }
            .text-muted {
                color: var(--text-muted);
                font-size: 0.8rem;
            }
        `;
        document.head.appendChild(style);
    },
        // =============================================
    // MISSING FUNCTIONS FOR BUTTONS
    // =============================================

    // Admin Management Functions
    toggleAdminForm() {
    console.log('Toggle admin form');
    const adminFormCard = document.getElementById('adminFormCard');
    if (adminFormCard) {
        const isVisible = adminFormCard.style.display === 'block';
        adminFormCard.style.display = isVisible ? 'none' : 'block';
        
        // Clear form when showing
        if (!isVisible) {
            const form = document.getElementById('createAdminForm');
            if (form) {
                form.reset();
            }
        }
    }
},

createNewAdmin() {
    console.log('Create new admin');
    const form = document.getElementById('createAdminForm');
    if (!form) return;

    // Get form values
    const fullName = document.getElementById('newAdminFullName')?.value;
    const email = document.getElementById('newAdminEmail')?.value;
    const password = document.getElementById('newAdminPassword')?.value;
    const role = document.getElementById('newAdminRole')?.value;

    console.log('Form values:', { fullName, email, password, role });

    // Manual validation
    if (!fullName || fullName.trim() === '') {
        this.showNotification('Please enter full name', 'error');
        document.getElementById('newAdminFullName').focus();
        return;
    }

    if (!email || email.trim() === '') {
        this.showNotification('Please enter email address', 'error');
        document.getElementById('newAdminEmail').focus();
        return;
    }

    if (!password || password.trim() === '') {
        this.showNotification('Please enter password', 'error');
        document.getElementById('newAdminPassword').focus();
        return;
    }

    if (!role) {
        this.showNotification('Please select admin role', 'error');
        document.getElementById('newAdminRole').focus();
        return;
    }

    // Check if email already exists
    const existingUser = this.currentData.users.find(user => user.email === email);
    if (existingUser) {
        this.showNotification('Email already exists. Please use a different email.', 'error');
        document.getElementById('newAdminEmail').focus();
        return;
    }

    // Create new admin
    const newAdmin = {
        id: 'ADM-' + Date.now(),
        fullName: fullName.trim(),
        email: email.trim(),
        password: password,
        role: role,
        isVerified: true,
        profileCompletion: 100,
        createdAt: new Date().toISOString(),
        lastLogin: new Date().toISOString(),
        permissions: this.getSelectedPermissions()
    };

    console.log('Creating new admin:', newAdmin);

    // Add to users array
    this.currentData.users.push(newAdmin);
    
    // Save to localStorage
    this.saveUsersToStorage();
    
    this.showNotification(`Admin account created for ${newAdmin.fullName}`, 'success');
    this.toggleAdminForm();
    form.reset();
    
    // Refresh all dashboard data to ensure consistency
    this.refreshDashboardData();
    
    console.log('✅ New admin created and dashboard refreshed');
},
debugAdminCreation() {
    console.log('=== DEBUG ADMIN CREATION ===');
    console.log('Current users in localStorage:', this.currentData.users);
    
    const adminUsers = this.currentData.users.filter(user => 
        user.role === 'admin' || 
        user.role === 'super_admin' || 
        user.role === 'moderator' || 
        user.role === 'support'
    );
    
    console.log('Admin users found:', adminUsers);
    console.log('Admin table element exists:', !!document.getElementById('adminsTableBody'));
    console.log('=== END DEBUG ===');
},

// Update the renderAdminUsers function with better logging
renderAdminUsers() {
    const adminsTableBody = document.getElementById('adminsTableBody');
    console.log('🔄 Rendering admin users...');
    console.log('Table body element:', adminsTableBody);
    
    if (!adminsTableBody) {
        console.error('❌ adminsTableBody not found!');
        return;
    }

    // Filter only admin users
    const adminUsers = this.currentData.users.filter(user => 
        user.role === 'admin' || 
        user.role === 'super_admin' || 
        user.role === 'moderator' || 
        user.role === 'support'
    );

    console.log('Admin users to display:', adminUsers);

    if (adminUsers.length === 0) {
        console.log('No admin users found, showing empty state');
        adminsTableBody.innerHTML = `
            <tr>
                <td colspan="7" class="empty-state">
                    <div class="empty-state-icon">👑</div>
                    <h3>No Admin Users Found</h3>
                    <p>Create your first admin user using the "New Admin" button</p>
                </td>
            </tr>
        `;
        return;
    }

    adminsTableBody.innerHTML = adminUsers.map(admin => {
        const roleDisplay = {
            'super_admin': 'Super Admin',
            'admin': 'Administrator', 
            'moderator': 'Moderator',
            'support': 'Support Admin'
        }[admin.role] || admin.role;

        console.log('Rendering admin:', admin);
        
        return `
            <tr>
                <td>${admin.id}</td>
                <td>${admin.fullName || 'Unknown'}</td>
                <td>${admin.email}</td>
                <td><span class="role-badge role-admin">${roleDisplay}</span></td>
                <td><span class="status-badge status-active">Active</span></td>
                <td>${this.formatDate(admin.lastLogin) || 'Never'}</td>
                <td>
                    <div class="admin-actions">
                        <button class="btn btn-sm btn-ghost" onclick="AdminDashboard.viewAdmin('${admin.id}')">
                            <i class="fas fa-eye"></i> View
                        </button>
                        ${admin.role !== 'super_admin' ? `
                            <button class="btn btn-sm btn-ghost" onclick="AdminDashboard.editAdmin('${admin.id}')">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                        ` : `
                            <button class="btn btn-sm btn-ghost" disabled>
                                <i class="fas fa-edit"></i> Edit
                            </button>
                        `}
                        ${admin.role !== 'super_admin' ? `
                            <button class="btn btn-sm btn-danger" onclick="AdminDashboard.deleteAdmin('${admin.id}')">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        ` : ''}
                    </div>
                </td>
            </tr>
        `;
    }).join('');
    
    console.log('✅ Admin users rendered successfully');
},

// Add delete admin function
deleteAdmin(adminId) {
    const admin = this.currentData.users.find(u => u.id === adminId);
    if (!admin) {
        this.showNotification('Admin not found', 'error');
        return;
    }

    if (admin.role === 'super_admin') {
        this.showNotification('Cannot delete super admin account', 'error');
        return;
    }

    if (confirm(`Are you sure you want to delete admin "${admin.fullName}"? This action cannot be undone.`)) {
        // Remove admin from users array
        this.currentData.users = this.currentData.users.filter(u => u.id !== adminId);
        this.saveUsersToStorage();
        
        this.showNotification(`Admin "${admin.fullName}" has been deleted`, 'success');
        this.renderAdminUsers();
        this.logAdminAction(`Deleted admin account: ${admin.fullName} (${adminId})`);
    }
},

getSelectedPermissions() {
    const permissions = [];
    const checkboxes = document.querySelectorAll('input[name="permissions"]:checked');
    checkboxes.forEach(checkbox => {
        permissions.push(checkbox.value);
    });
    return permissions;
},

viewAdmin(adminId) {
    const admin = this.currentData.users.find(u => u.id === adminId);
    if (admin) {
        this.showNotification(`Viewing admin: ${admin.fullName} (${admin.role})`, 'info');
        // In a real app, you'd open a modal with admin details
    }
},

// Helper function to edit admin
editAdmin(adminId) {
    const admin = this.currentData.users.find(u => u.id === adminId);
    if (admin) {
        this.showNotification(`Editing admin: ${admin.fullName}`, 'info');
        // In a real app, you'd open an edit form
    }
},

    // Export Functions
    exportData() {
        console.log('Export data');
        this.showNotification('Exporting data as CSV...', 'info');
        // Simple CSV export simulation
        const usersCSV = this.convertToCSV(this.currentData.users);
        this.downloadCSV(usersCSV, 'users_export.csv');
    },

    exportReport() {
        console.log('Export report');
        this.showNotification('Generating and exporting report...', 'info');
        // Simulate report generation
        setTimeout(() => {
            this.showNotification('Report exported successfully!', 'success');
        }, 1000);
    },

    // Filter Functions
    filterContent() {
        console.log('Filter content');
        this.showNotification('Applying content filters...', 'info');
    },

    // Add User Function
    addUser() {
        console.log('Add user');
        this.showNotification('Opening user creation form...', 'info');
        // In a real app, this would open a user creation modal
    },

    // Create Job Function
    createJob() {
        console.log('Create job');
        this.showNotification('Opening job creation form...', 'info');
        // In a real app, this would open a job creation modal
    },

    // Create Notification Function
    createNotification() {
        console.log('Create notification');
        this.showNotification('Opening notification creation form...', 'info');
        // In a real app, this would open a notification creation modal
    },

    // View Notification Function
    viewNotification(notificationId) {
        console.log('View notification:', notificationId);
        const notification = this.currentData.notifications.find(n => n.id === notificationId);
        if (notification) {
            this.showNotification(`Viewing: ${notification.title} - ${notification.message}`, 'info');
        }
    },

    // System Settings Functions
    loadSystemSettings() {
        console.log('Loading system settings...');
        // Settings are already loaded in the form
    },

    saveSystemSettings() {
        console.log('Saving system settings...');
        
        const settings = {
            siteName: document.getElementById('siteName')?.value || 'OpusLink',
            siteEmail: document.getElementById('siteEmail')?.value || 'contact@opuslink.com',
            siteDescription: document.getElementById('siteDescription')?.value || 'Connecting talent with opportunity',
            currency: document.getElementById('currency')?.value || 'INR',
            commissionRate: document.getElementById('commissionRate')?.value || '10',
            sessionTimeout: document.getElementById('sessionTimeout')?.value || '60',
            maxLoginAttempts: document.getElementById('maxLoginAttempts')?.value || '5',
            autoApprovePayments: document.querySelector('[name="autoApprovePayments"]')?.checked || false,
            twoFactorAuth: document.querySelector('[name="twoFactorAuth"]')?.checked || false,
            updatedAt: new Date().toISOString()
        };

        this.currentData.settings = settings;
        localStorage.setItem(this.config.LOCAL_STORAGE_KEYS.SETTINGS, JSON.stringify(settings));
        this.showNotification('System settings saved successfully!', 'success');
    },
    refreshDashboardData() {
    console.log('🔄 Refreshing dashboard data...');
    
    // Reload all data from localStorage
    this.loadAllRealData();
    
    // Update all sections
    this.updateAllDashboardData();
    
    // Update navigation badges
    this.updateNavigationBadges();
    
    console.log('✅ Dashboard data refreshed');
},


    // Utility Functions for Export
    convertToCSV(data) {
        if (!data || data.length === 0) return '';
        
        const headers = Object.keys(data[0]).join(',');
        const rows = data.map(item => 
            Object.values(item).map(value => 
                typeof value === 'string' ? `"${value.replace(/"/g, '""')}"` : value
            ).join(',')
        ).join('\n');
        
        return `${headers}\n${rows}`;
    },

    downloadCSV(csvContent, fileName) {
        const blob = new Blob([csvContent], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = fileName;
        link.click();
        window.URL.revokeObjectURL(url);
    },

    // Notification Bell Function
    setupNotificationBell() {
        const notificationBtn = document.querySelector('.notification-btn');
        if (notificationBtn) {
            notificationBtn.addEventListener('click', () => {
                this.showSection('notifications');
            });
        }
    },
    // =============================================
// MODAL HANDLERS
// =============================================

setupModalHandlers() {
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            this.removeModal();
        }
    });
    
    // Close modal when clicking on backdrop
    document.addEventListener('click', (e) => {
        if (e.target.classList.contains('modal-backdrop')) {
            this.removeModal();
        }
    });
},
// =============================================
// ADMIN DETAILS MODAL (Complete Implementation)
// =============================================

viewAdmin(adminId) {
    const admin = this.currentData.users.find(u => u.id === adminId);
    if (!admin) {
        this.showNotification('Admin not found', 'error');
        return;
    }

    const roleDisplay = {
        'super_admin': 'Super Administrator',
        'admin': 'Administrator', 
        'moderator': 'Moderator',
        'support': 'Support Admin'
    }[admin.role] || admin.role;

    // Get permissions display
    const permissionLabels = {
        'user_management': '👥 User Management',
        'content_moderation': '🛡️ Content Moderation', 
        'payment_management': '💰 Payment Management',
        'system_settings': '⚙️ System Settings',
        'reports': '📊 Reports & Analytics',
        'admin_management': '👑 Admin Management'
    };

    const content = `
        <div style="text-align: center; margin-bottom: 24px;">
            <div class="user-avatar-modal" style="background: linear-gradient(135deg, var(--gold-primary), var(--gold-secondary));">
                ${(admin.fullName || 'A').charAt(0).toUpperCase()}
            </div>
            <h3 style="color: var(--text-primary); margin-bottom: 8px;">${admin.fullName}</h3>
            <p style="color: var(--text-secondary);">${admin.email}</p>
            <div style="margin-top: 12px;">
                <span class="role-badge role-admin" style="font-size: 1rem; padding: 8px 20px; background: rgba(255, 215, 0, 0.2); border: 2px solid var(--gold-primary);">
                    👑 ${roleDisplay}
                </span>
            </div>
        </div>

        <div class="detail-grid">
            <div class="detail-item">
                <span class="detail-label">Admin ID</span>
                <div class="detail-value" style="font-family: monospace; background: var(--bg-primary);">${admin.id}</div>
            </div>
            <div class="detail-item">
                <span class="detail-label">Status</span>
                <div class="detail-value">
                    <span class="status-indicator status-active" style="background: rgba(16, 185, 129, 0.2); border: 1px solid #10b981;">
                        <i class="fas fa-check-circle"></i> Active
                    </span>
                </div>
            </div>
            <div class="detail-item">
                <span class="detail-label">Profile Completion</span>
                <div class="detail-value">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="flex: 1; background: var(--bg-primary); height: 6px; border-radius: 3px; overflow: hidden;">
                            <div style="width: ${admin.profileCompletion || 100}%; height: 100%; background: linear-gradient(90deg, var(--gold-primary), var(--gold-secondary));"></div>
                        </div>
                        <span>${admin.profileCompletion || 100}%</span>
                    </div>
                </div>
            </div>
            <div class="detail-item">
                <span class="detail-label">Join Date</span>
                <div class="detail-value">
                    <i class="fas fa-calendar-plus" style="margin-right: 8px; color: var(--text-muted);"></i>
                    ${this.formatDate(admin.createdAt)}
                </div>
            </div>
            <div class="detail-item">
                <span class="detail-label">Last Login</span>
                <div class="detail-value">
                    <i class="fas fa-sign-in-alt" style="margin-right: 8px; color: var(--text-muted);"></i>
                    ${admin.lastLogin ? this.formatDate(admin.lastLogin) : 'Never logged in'}
                </div>
            </div>
            <div class="detail-item">
                <span class="detail-label">Last Updated</span>
                <div class="detail-value">
                    <i class="fas fa-sync-alt" style="margin-right: 8px; color: var(--text-muted);"></i>
                    ${admin.updatedAt ? this.formatDate(admin.updatedAt) : 'Never updated'}
                </div>
            </div>
        </div>

        <div class="detail-section">
            <div class="detail-section-title">
                <i class="fas fa-shield-alt" style="color: var(--gold-primary);"></i>
                Administrator Permissions
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 12px;">
                ${admin.permissions && admin.permissions.length > 0 ? 
                    admin.permissions.map(perm => `
                        <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--bg-primary); border-radius: 8px; border: 1px solid var(--border-color);">
                            <div style="width: 8px; height: 8px; border-radius: 50%; background: var(--gold-primary);"></div>
                            <div>
                                <div style="font-weight: 600; color: var(--text-primary);">${permissionLabels[perm] || perm}</div>
                                <div style="font-size: 0.8rem; color: var(--text-muted);">Full access rights</div>
                            </div>
                        </div>
                    `).join('') 
                    : `
                    <div style="text-align: center; padding: 20px; color: var(--text-muted);">
                        <i class="fas fa-ban" style="font-size: 2rem; margin-bottom: 8px;"></i>
                        <div>No specific permissions assigned</div>
                    </div>
                `}
            </div>
        </div>

        <div class="detail-section">
            <div class="detail-section-title">
                <i class="fas fa-chart-line" style="color: var(--gold-primary);"></i>
                Activity Summary
            </div>
            <div class="detail-grid">
                <div class="detail-item">
                    <span class="detail-label">Total Actions</span>
                    <div class="detail-value" style="text-align: center; font-size: 1.5rem; font-weight: bold; color: var(--gold-primary);">
                        ${this.getAdminActionCount(admin.id)}
                    </div>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Recent Activity</span>
                    <div class="detail-value" style="text-align: center; font-size: 1.5rem; font-weight: bold; color: var(--info);">
                        ${this.getRecentAdminActivity(admin.id)}
                    </div>
                </div>
            </div>
        </div>

        ${admin.role === 'super_admin' ? `
            <div class="detail-section" style="border-left: 4px solid var(--gold-primary); background: rgba(255, 215, 0, 0.05);">
                <div class="detail-section-title" style="color: var(--gold-primary);">
                    <i class="fas fa-crown"></i>
                    Super Administrator Privileges
                </div>
                <div style="color: var(--text-secondary); line-height: 1.6;">
                    This user has full system access including:
                    <ul style="margin: 12px 0; padding-left: 20px;">
                        <li>Complete system configuration access</li>
                        <li>Ability to manage all administrator accounts</li>
                        <li>Full database and system maintenance rights</li>
                        <li>Cannot be deleted or demoted by other admins</li>
                    </ul>
                </div>
            </div>
        ` : ''}
    `;

    const footer = `
        <button class="btn btn-ghost" onclick="AdminDashboard.removeModal()">
            <i class="fas fa-times"></i> Close
        </button>
        ${admin.role !== 'super_admin' ? `
            <button class="btn btn-warning" onclick="AdminDashboard.editAdmin('${admin.id}')">
                <i class="fas fa-edit"></i> Edit Admin
            </button>
            <button class="btn btn-danger" onclick="AdminDashboard.deleteAdminConfirm('${admin.id}')">
                <i class="fas fa-trash"></i> Delete Admin
            </button>
        ` : `
            <button class="btn btn-ghost" disabled style="opacity: 0.5;">
                <i class="fas fa-edit"></i> Edit (Restricted)
            </button>
            <button class="btn btn-ghost" disabled style="opacity: 0.5;">
                <i class="fas fa-trash"></i> Delete (Restricted)
            </button>
        `}
    `;

    this.createModal('Administrator Details', content, footer);
},

// Helper function to get admin action count
getAdminActionCount(adminId) {
    const adminLogs = JSON.parse(localStorage.getItem('admin_logs') || '[]');
    return adminLogs.filter(log => log.adminId === adminId).length;
},

// Helper function to get recent admin activity
getRecentAdminActivity(adminId) {
    const adminLogs = JSON.parse(localStorage.getItem('admin_logs') || '[]');
    const recentLogs = adminLogs
        .filter(log => log.adminId === adminId)
        .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
        .slice(0, 5);
    
    return recentLogs.length;
},

// Delete admin confirmation
deleteAdminConfirm(adminId) {
    const admin = this.currentData.users.find(u => u.id === adminId);
    if (!admin) return;

    const content = `
        <div style="text-align: center; padding: 20px;">
            <div style="font-size: 4rem; color: var(--error); margin-bottom: 16px;">⚠️</div>
            <h3 style="color: var(--text-primary); margin-bottom: 12px;">Delete Administrator</h3>
            <p style="color: var(--text-secondary); line-height: 1.6;">
                Are you sure you want to delete the administrator account for 
                <strong>${admin.fullName}</strong>? This action cannot be undone.
            </p>
            <div style="background: var(--bg-secondary); padding: 16px; border-radius: 8px; margin-top: 20px; border-left: 4px solid var(--error);">
                <strong style="color: var(--error);">Warning:</strong> This will permanently remove all admin privileges and access rights.
            </div>
        </div>
    `;

    const footer = `
        <button class="btn btn-ghost" onclick="AdminDashboard.removeModal()">
            <i class="fas fa-times"></i> Cancel
        </button>
        <button class="btn btn-danger" onclick="AdminDashboard.deleteAdmin('${admin.id}')">
            <i class="fas fa-trash"></i> Delete Administrator
        </button>
    `;

    this.createModal('Confirm Deletion', content, footer);
},

// Delete admin function
deleteAdmin(adminId) {
    const admin = this.currentData.users.find(u => u.id === adminId);
    if (!admin) {
        this.showNotification('Admin not found', 'error');
        return;
    }

    if (admin.role === 'super_admin') {
        this.showNotification('Cannot delete super admin account', 'error');
        this.removeModal();
        return;
    }

    // Remove admin from users array
    this.currentData.users = this.currentData.users.filter(u => u.id !== adminId);
    this.saveUsersToStorage();
    
    this.showNotification(`Admin "${admin.fullName}" has been deleted`, 'success');
    this.removeModal();
    this.renderAdminUsers();
    this.logAdminAction(`Deleted admin account: ${admin.fullName} (${adminId})`);
},

    // Initialize all event listeners
    setupAllEventListeners() {
        console.log('Setting up all event listeners...');
        
        // Admin form
        const createAdminForm = document.getElementById('createAdminForm');
        if (createAdminForm) {
            createAdminForm.addEventListener('submit', (e) => {
                e.preventDefault();
                this.createNewAdmin();
            });
        }

        // System settings form
        const systemSettingsForm = document.getElementById('systemSettingsForm');
        if (systemSettingsForm) {
            systemSettingsForm.addEventListener('submit', (e) => {
                e.preventDefault();
                this.saveSystemSettings();
            });
        }

        // Export buttons
        const exportButtons = document.querySelectorAll('.btn-ghost:has(.fa-download)');
        exportButtons.forEach(btn => {
            btn.addEventListener('click', () => this.exportData());
        });

        // Add user buttons
        const addUserButtons = document.querySelectorAll('.btn-primary:has(.fa-plus)');
        addUserButtons.forEach((btn, index) => {
            if (index === 0) { // First add button in user management
                btn.addEventListener('click', () => this.addUser());
            } else if (index === 1) { // Second add button in job management
                btn.addEventListener('click', () => this.createJob());
            } else if (index === 2) { // Third add button in notifications
                btn.addEventListener('click', () => this.createNotification());
            }
        });

        // Filter button
        const filterBtn = document.querySelector('.btn-primary:has(.fa-filter)');
        if (filterBtn) {
            filterBtn.addEventListener('click', () => this.filterContent());
        }

        // Bulk approve button
        const bulkApproveBtn = document.querySelector('.btn-primary:has(.fa-check-double)');
        if (bulkApproveBtn) {
            bulkApproveBtn.addEventListener('click', () => this.bulkApproveVerifications());
        }

        // Notification bell
        this.setupNotificationBell();
        this.setupPaymentFilters();

        console.log('✅ All event listeners setup complete');
    }
    
};


// Initialize with custom styles
document.addEventListener('DOMContentLoaded', function() {
    AdminDashboard.addCustomStyles();
    
    // For demo purposes, create an admin user if none exists
    const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
    if (!currentUser.id) {
        const adminUser = {
            id: 'ADM-001',
            fullName: 'Administrator',
            email: 'admin@opuslink.com',
            role: 'admin',
            isVerified: true
        };
        localStorage.setItem('currentUser', JSON.stringify(adminUser));
        sessionStorage.setItem('currentUser', JSON.stringify(adminUser));
    }
    
    AdminDashboard.init();
});
</script>
</body>
</html>